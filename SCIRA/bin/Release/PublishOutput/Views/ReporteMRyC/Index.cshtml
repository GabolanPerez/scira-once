@model IEnumerable<SCIRA.ViewModels.MRyCRepModel>
@using SCIRA.Models
@using SCIRA.Utilidades
@using System.Reflection;
@{
    ViewBag.Title = "Reporte de MRyC";
    Layout = "~/Views/Shared/_LayoutReporte.cshtml";
    List<k_riesgo_derogado> riesgosE = ViewBag.RiesgoDerogado;
}

<script>
    $("body").addClass('loading');

    $(document).ready(function () {
        $('body').removeClass('loading');
    });
</script>


<h2>@Strings.getMSG("ReporteMRyCIndex001")</h2>

<ul class="nav nav-tabs">
    <li class="active"><a href="#cnl" data-toggle="tab"><h4>@Strings.getMSG("ReporteMRyCIndex002")</h4></a></li>
    <li><a href="#cnnl" data-toggle="tab"><h4>@Strings.getMSG("RiesgoRiesgos004")</h4></a></li>
</ul>

<div id="myTabContent" class="tab-content">


    <div class="tab-pane fade active in" id="cnl">

        <br><br>

        <table class="results table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th class="search">@Strings.getMSG("Entidad")</th>
                    <th class="search">@Strings.getMSG("ReporteEstructuraIndex001")</th>
                    <th class="search">@Strings.getMSG("MP")</th>
                    <th class="search">@Strings.getMSG("ReporteEstructuraIndex002")</th>
                    <th class="search">@Strings.getMSG("P")</th>
                    <th class="search">@Strings.getMSG("ReporteEstructuraIndex003")</th>
                    <th class="search">@Strings.getMSG("SP")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex010")</th>
                    <th class="search">@Strings.getMSG("RiesgoCreate037")</th>
                    <th class="search">@Strings.getMSG("SubProcesoCreate009")</th>
                    <th class="search">@Strings.getMSG("SubProcesoCreate010")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex011")</th>
                    <th class="search">@Strings.getMSG("Menu005")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex012")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex013")</th>
                    <th class="search">@Strings.getMSG("SubProcesoCreate016")</th>
                    <th class="search">@Strings.getMSG("SubProcesoCreate017")</th>
                    <th class="search">@Strings.getMSG("ManualesDelete001")</th>
                    @for (int i = 0; i < 20; i++)
                    {
                        if (ViewBag.CamposExtraSubProceso[i].es_visible)
                        {
                            <th class="search">@ViewBag.CamposExtraSubProceso[i].nb_campo</th>
                        }
                    }
                    <th class="search">@Strings.getMSG("RiesgoRiesgos002")</th>
                    <th class="search">@Strings.getMSG("RiesgoRiesgos003")</th>
                    <th class="search">@Strings.getMSG("Menu018")</th>
                    <th class="search">@Strings.getMSG("Menu019")</th>
                    <th class="search">@Strings.getMSG("Menu020")</th>
                    <th class="search">@Strings.getMSG("Menu021")</th>
                    <th class="search">@Strings.getMSG("Menu022")</th>
                    <th class="search">@Strings.getMSG("Menu024")
					</th>
                    <th class="search">@Strings.getMSG("Menu025")</th>
                    <th class="search">@Strings.getMSG("Menu023")</th>
                    <th class="search">@Strings.getMSG("Menu026")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex004")</th>
                    <th class="search">@Strings.getMSG("RiesgoCreate005")</th>
                    <th class="search">@Strings.getMSG("RiesgoCreate098")</th>
                    <th class="search">@Strings.getMSG("RiesgoCreate095")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex014")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex015")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex016")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex017")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex018")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex019")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex020")</th>

                    @for (int i = 0; i < 20; i++)
                    {
                        if (ViewBag.CamposExtraRiesgo[i].es_visible)
                        {
                            <th class="search">@ViewBag.CamposExtraRiesgo[i].nb_campo</th>
                        }
                    }

                    <th class="search">@Strings.getMSG("RiesgoCreate084")</th>
                    <th class="search">@Strings.getMSG("RiesgoCreate085")</th>
                    <th class="search">@Strings.getMSG("RevisionControlCreate037")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex007")</th>
                    <th class="search">@Strings.getMSG("RiesgoCreate079")</th>
                    <th class="search">@Strings.getMSG("Menu032")</th>
                    <th class="search">@Strings.getMSG("Menu031")</th>
                    <th class="search">@Strings.getMSG("Menu034")</th>
                    <th class="search">@Strings.getMSG("Menu033")</th>
                    <th class="search">@Strings.getMSG("Menu035")</th>
                    <th class="search">@Strings.getMSG("Menu030")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex008")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex009")</th>
                    <th class="search">@Strings.getMSG("ControlDelete001")</th>

                    @for (int i = 0; i < 20; i++)
                    {
                        if (ViewBag.CamposExtraControl[i].es_visible)
                        {
                            <th class="search">@ViewBag.CamposExtraControl[i].nb_campo</th>
                        }
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    Type m_tipo = null;
                    PropertyInfo[] m_propiedades = null;
                    m_tipo = item.GetType();
                    m_propiedades = m_tipo.GetProperties();
                    var prop = m_propiedades.First();

                <tr>
                    <td>@(item.en)</td>
                    <td>@(item.respEn)</td>
                    <td>@(item.mp)</td>
                    <td>@(item.respMp)</td>
                    <td>@(item.pr)</td>
                    <td>@(item.respPr)</td>
                    <td>@(item.sp)</td>
                    <td>@(item.descripcionSp)</td>
                    <td>@(item.respSp)</td>
                    <td>@(item.SpAnterior)</td>
                    <td>@(item.SpSiguiente)</td>
                    <td>@(item.tipologia_sp)</td>
                    <td>@(item.lineas_negocio)</td>
                    <td>@(item.etapa)</td>
                    <td>@(item.sub_Etapa)</td>
                    <td>@(item.areas_involucradas)</td>
                    <td>@(item.aplicaciones_relacionadas)</td>
                    <td>@(item.clave_manual)</td>


                    @for (int i = 0; i < 20; i++)
                    {
                        if (ViewBag.CamposExtraSubProceso[i].es_visible)
                        {
                            prop = m_propiedades.Where(p => p.Name == string.Format("campo_extra_sp{0:00}", i + 1)).First();
                            <td>@prop.GetValue(item, null)</td>
                        }
                    }


                    <td>@(item.cl_riesgo)</td>
                    <td>@(item.evento_riesgo)</td>
                    <td>@(item.categoria_riesgo)</td>
                    <td>@(item.tipo_riesgo)</td>
                    <td>@(item.clase_tipologia_riesgo)</td>
                    <td>@(item.sub_clase_tipologia_riesgo)</td>
                    <td>@(item.tipologia_riesgo)</td>
                    <td>@(item.tipo_impacto)</td>
                    <td>@(item.magnitud_impacto)</td>
                    <td>@(item.probabilidad_ocurrencia)</td>
                    <td>@(item.criticidad))</td>
                    <td>@(item.afectacion_contable)</td>
                    <td>@(item.supuesto_normativo)</td>
                    <td>@(item.euc)</td>

                    <td>@(item.es_riesgo_operativo)</td>
                    <td>@(item.nb_proceso_ro)</td>
                    <td>@(item.nb_producto_ro)</td>
                    <td>@(item.nb_sub_tipo_ro)</td>
                    <td>@(item.nb_linea_negocio_ro)</td>
                    <td>@(item.nb_frecuencia_ro)</td>
                    <td>@(item.nb_impacto_ro)</td>
                    <td>@(item.criticidad_ro)</td>

                    @for (int i = 0; i < 20; i++)
                    {
                        if (ViewBag.CamposExtraRiesgo[i].es_visible)
                        {
                            prop = m_propiedades.Where(p => p.Name == string.Format("campo_extra_r{0:00}", i + 1)).First();
                            <td>@prop.GetValue(item, null)</td>
                        }
                    }

                    <td>@(item.cl_control)</td>
                    <td>@(item.actividad_control)</td>
                    <td>@(item.evidencia_control)</td>
                    <td>@(item.aplicacion)</td>
                    <td>@(item.accion_correctora)</td>
                    <td>@(item.naturaleza_control)</td>
                    <td>@(item.frecuencia_control)</td>
                    <td>@(item.categoria_control)</td>
                    <td>@(item.tipologia_control)</td>
                    <td>@(item.tipo_evidencia)</td>
                    <td>@(item.grado_cobertura)</td>
                    <td>@(item.responsable_control)</td>
                    <td>@(item.ejecutor_control)</td>
                    <td>@(item.control_clave)</td>

                    @for (int i = 0; i < 20; i++)
                    {
                        if (ViewBag.CamposExtraControl[i].es_visible)
                        {
                            prop = m_propiedades.Where(p => p.Name == string.Format("campo_extra_c{0:00}", i + 1)).First();
                            <td>@prop.GetValue(item, null)</td>
                        }
                    }
                </tr>
                }
            </tbody>
        </table>

    </div>


    <div class="tab-pane" id="cnnl">

        <br><br>

        <table class="results2 table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th class="search">@Strings.getMSG("Entidad")</th>
                    <th class="search">@Strings.getMSG("MP")</th>
                    <th class="search">@Strings.getMSG("P")</th>
                    <th class="search">@Strings.getMSG("SP")</th>
                    <th class="search">@Strings.getMSG("EventoRiesgoIndex001")</th>
                    <th class="search">@Strings.getMSG("RiesgoDelete002")</th>
                    <th class="search">@Strings.getMSG("Menu019")</th>
                    <th class="search">@Strings.getMSG("Menu022")</th>
                    <th class="search">@Strings.getMSG("Menu024")</th>
                    <th class="search">@Strings.getMSG("Menu025")</th>
                    <th class="search">@Strings.getMSG("Menu023")</th>
                    <th class="search">@Strings.getMSG("Menu026")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex004")</th>
                    <th class="search">@Strings.getMSG("RiesgoCreate005")</th>
                    <th class="search">@Strings.getMSG("RiesgoCreate098")</th>
                    <th class="search">@Strings.getMSG("RiesgoCreate095")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex014")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex015")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex016")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex017")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex018")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex019")</th>
                    <th class="search">@Strings.getMSG("ReporteMRyCIndex021")</th>
                    @for (int i = 0; i < 20; i++)
                    {
                        if (ViewBag.CamposExtraRiesgo[i].es_visible)
                        {
                            <th class="search">@ViewBag.CamposExtraRiesgo[i].nb_campo</th>
                        }
                    }

                </tr>
            </thead>
            <tbody>
                @foreach (var riesgo in riesgosE)
                {
                    Type m_tipo = null;
                    PropertyInfo[] m_propiedades = null;
                    m_tipo = riesgo.GetType();
                    m_propiedades = m_tipo.GetProperties();
                    var prop = m_propiedades.First();

                <tr>
                    <td >@riesgo.c_sub_proceso.c_proceso.c_macro_proceso.c_entidad.cl_entidad - @riesgo.c_sub_proceso.c_proceso.c_macro_proceso.c_entidad.nb_entidad</td>
                    <td >@riesgo.c_sub_proceso.c_proceso.c_macro_proceso.cl_macro_proceso - @riesgo.c_sub_proceso.c_proceso.c_macro_proceso.nb_macro_proceso</td>
                    <td >@riesgo.c_sub_proceso.c_proceso.cl_proceso - @riesgo.c_sub_proceso.c_proceso.nb_proceso</td>
                    <td >@riesgo.c_sub_proceso.cl_sub_proceso - @riesgo.c_sub_proceso.nb_sub_proceso</td>
                    <td >@riesgo.evento</td>
                    <td >@riesgo.justificacion</td>
                    <td >@riesgo.tipo_riesgo</td>
                    <td >@riesgo.tipologia_riesgo</td>
                    <td >@riesgo.tipo_impacto</td>
                    <td >@riesgo.magnitud_impacto</td>
                    <td >@riesgo.probabilidad_ocurrencia</td>
                    <td >@riesgo.criticidad</td>
                    <td >@(riesgo.tiene_afectacion_contable ? Strings.getMSG("AjustesMailIndex015"):Strings.getMSG("AjustesMailIndex015"))</td>
                    <td >@riesgo.supuesto_normativo</td>
                    <td >@riesgo.euc</td>
                    <td >@(riesgo.es_riesgo_operativo ? Strings.getMSG("AjustesMailIndex015"):Strings.getMSG("AjustesMailIndex015"))</td>
                    <td >@riesgo.proceso_riesgo_operacional</td>
                    <td >@riesgo.sub_tipo_producto_riesgo_operacional</td>
                    <td >@riesgo.sub_tipo_riesgo_operacional</td>
                    <td >@riesgo.linea_negocio_riesgo_operacional</td>
                    <td >@riesgo.frecuencia_riesgo_operacional</td>
                    <td >@riesgo.impacto_riesgo_operacional</td>
                    <td >@riesgo.criticidadRO</td>
                    @for (int i = 0; i < 20; i++)
                    {
                        if (ViewBag.CamposExtraRiesgo[i].es_visible)
                        {
                            prop = m_propiedades.Where(p => p.Name == string.Format("campo{0:00}", i + 1)).First();
                            <td>@prop.GetValue(riesgo, null)</td>
                        }
                    }
                </tr>
                }
            </tbody>
        </table>

    </div>
</div>
