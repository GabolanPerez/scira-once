@model SCIRA.Models.k_programa_trabajo
@using SCIRA.Utilidades
@{
    ViewBag.Title = "Editar";
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";

    List<SCIRA.Models.c_campo_programa> InfoCamposExtra = ViewBag.InfoCamposExtra;

    Dictionary<int, string> Errors;
    Dictionary<int, string> DCE;

    if (ViewBag.Errors != null)
    {
        Errors = ViewBag.Errors;
    }
    else
    {
        Errors = new Dictionary<int, string>();
    }

    if (ViewBag.DCE != null)
    {
        DCE = ViewBag.DCE;
    }
    else
    {
        DCE = new Dictionary<int, string>();
    }

    SCIRA.Models.c_prueba_auditoria prueba = ViewBag.prueba;
    SCIRA.Models.c_auditoria auditoria = prueba.c_auditoria;

}

<script type="text/javascript" src="~/Scripts/sharedScripts.js"></script>
<link href="~/Content/bootstrap-toggle.min.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-toggle.min.js"></script>

<link href="~/Content/base.css" rel="stylesheet" />
<link href="~/Content/bootstrap-datetimepicker.css" rel="stylesheet" />

<script type="text/javascript" src="~/Scripts/moment-with-locales.js"></script>
<script type="text/javascript" src="~/Scripts/bootstrap-datetimepicker.js"></script>

@*<script src="~/Scripts/dropzone.js"></script>*@
<script src="~/Scripts/dropzone-config.js"></script>


<link href="~/Content/font-awesome.min.css" rel="stylesheet" />

<script>
    $("document").ready(function () {

        $(".datetimepicker").datetimepicker({
            locale: 'es',
            format: '@ViewBag.DateFormat',
            minDate: "01/01/1900"
        });

        $(function () {
            $('#IncidenciaDetectada .toggle').click(function () {
                setTimeout(function () {
                    if ($("#tiene_incidencia").is(':checked')) {
                        $(".forIncident").removeAttr("hidden");
                        console.log("mostrando");
                    } else {
                        $(".forIncident").attr("hidden", "hidden");
                        console.log("ocultar");
                    }
                }, 250);
            });
        });
    });

    function deleteFile(id,nb_archivo) {
        confirmationModal.initModal({
            title: '@Strings.getMSG("AuditoriaEditSeguimientoObservaciones007") ' + nb_archivo + '?',
            action: 'deleteFileConfirm('+id+')'
        });
    }

    function deleteFileConfirm(id) {
        //eliminar archivo con ajax
        $.ajax({
            dataType: "html",
            type: "post",
            url: '@(Url.Action("DeleteByUser","Archivos"))',
            data: { id },
            success: function (data) {
                if (data == id) {
                    toastr.success("@Strings.getMSG("AuditoriaEditSeguimientoObservaciones008")");
                    //eliminar fila
                    $("#fr" + id).remove();
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                toastr.error("@Strings.getMSG("AuditoriaEditSeguimientoObservaciones009")");
            }
        });
    }

</script>

<h2>@Strings.getMSG("ProcesosAuditoriaEditPrueba015")</h2>

<ul class="nav nav-tabs">
    <li class="active"><a href="#pes1" id="pes1b" data-toggle="tab"><h4>@Strings.getMSG("UsuarioCreate011")<span id="ind1"></span> </h4></a></li>
    <li><a href="#pes2" data-toggle="tab" id="pes2b"><h4>@Strings.getMSG("ProcesosAuditoriaCreatePlaneacion014")<span id="ind2"></span></h4></a></li>
</ul>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken();
    @Html.HiddenFor(m => m.idd_programa_trabajo);
    @Html.HiddenFor(m => m.id_prueba_auditoria);
    @Html.HiddenFor(m => m.idd_auditoria);

    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade active in" id="pes1">
            <div class="form-horizontal well">
                <h4>@prueba.nb_prueba_auditoria</h4>
                <hr />
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                <div class="row ">
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("Menu148")</label>
                        <div class="col-xs-6 col-md-5">
                            <div class="input-group">
                                <input type="text" class="form-control disabled" disabled value="@auditoria.nb_auditoria" />
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("ProcesosAuditoriaEditEjecucion015")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("DivisionAuditoria001")</label>
                        <div class="col-xs-6 col-md-5">
                            <div class="input-group">
                                <input type="text" class="form-control disabled" disabled id="DivisionAuditoria" value="@ViewBag.nb_division_auditoria" />
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("DivisionAuditoria006")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("Entidad")</label>
                        <div class="col-xs-6 col-md-5">
                            <div class="input-group">
                                <input type="text" class="form-control disabled" disabled value="@auditoria.c_entidad.nb_entidad" />
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("ProcesosAuditoriaEditEjecucion016")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("Area")</label>
                        <div class="col-xs-6 col-md-5">
                            <div class="input-group">
                                <input type="text" class="form-control disabled" disabled value="@auditoria.c_area.nb_area" />
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("ProcesosAuditoriaEditEjecucion017")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("MCSubProcesoIndex002")</label>
                        <div class="col-xs-6 col-md-5">
                            <div class="input-group">
                                <input type="text" class="form-control disabled" disabled value="@(auditoria.es_regulada ? "Regulada":"Normal")" />
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("ProcesosAuditoriaEditEjecucion018")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("AuditoriaIndexUniversoAuditable002")</label>
                        <div class="col-xs-6 col-md-5">
                            <div class="input-group">
                                <input type="text" class="form-control disabled" disabled value="@auditoria.c_solicitante_auditoria.nb_solicitante_auditoria" />
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("ProcesosAuditoriaEditEjecucion019")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row ">
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("ProcesosAuditoriaEditPrueba002")</label>
                        <div class="col-xs-6 col-md-5">
                            <textarea class="form-control" disabled rows="3">@(prueba.ds_prueba_auditoria)</textarea>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("ProcesosAuditoriaPruebasEjecucion002")</label>
                        <div class="col-xs-6 col-md-5">
                            @Html.TextAreaFor(model => model.resultado, new { @class = "form-control", @rows = "3", @title = Strings.getMSG("Atencion"), data_toggle = "popover", data_trigger = "hover", data_content = Strings.getMSG("ProcesosAuditoriaEditPrueba006") })
                            @Html.ValidationMessageFor(model => model.resultado, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>

                <div class="row" id="Contenedor1">
                    <div class="form-group" id="IncidenciaDetectada">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("ProcesosAuditoriaEditPrueba003")</label>
                        <div class="col-xs-3 col-md-2">
                            <div class="input-group">
                                @Html.EditorFor(model => model.tiene_incidencia, new { htmlAttributes = new { data_toggle = "toggle", data_on = Strings.getMSG("AjustesMailIndex015"), data_off = Strings.getMSG("AjustesMailIndex016"), data_width = "140" } })
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("ProcesosAuditoriaEditPrueba007")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row forIncident" @(Model.tiene_incidencia ? "" : "hidden=hidden")>
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("ProcesosAuditoriaPruebasEjecucion003")</label>
                        <div class="col-xs-6 col-md-5">
                            @Html.TextAreaFor(model => model.incidencia_detectada, new { @class = "form-control", @rows = "3", @title = Strings.getMSG("Atencion"), data_toggle = "popover", data_trigger = "hover", data_content = @Strings.getMSG("ProcesosAuditoriaEditPrueba008") })
                            @Html.ValidationMessageFor(model => model.incidencia_detectada, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>

                <div class="row forIncident" @(Model.tiene_incidencia ? "" : "hidden=hidden")>
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("ProcesosAuditoriaPruebasEjecucion004")</label>
                        <div class="col-xs-6 col-md-5">
                            @Html.TextAreaFor(model => model.recomendaciones, new { @class = "form-control", @rows = "3", @title = Strings.getMSG("Atencion"), data_toggle = "popover", data_trigger = "hover", data_content = @Strings.getMSG("ProcesosAuditoriaEditPrueba009") })
                            @Html.ValidationMessageFor(model => model.recomendaciones, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>

                <div class="row forIncident" @(Model.tiene_incidencia ? "" : "hidden=hidden")>
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("Menu026")</label>
                        <div class="col-xs-6 col-md-5">
                            @Html.DropDownList("id_criticidad_programa_trabajo", null, Strings.getMSG("ProcesosAuditoriaPruebasEjecucion013"), htmlAttributes: new { @class = "form-control", @title = Strings.getMSG("Atencion"), data_toggle = "popover", data_trigger = "hover", data_content = @Strings.getMSG("ProcesosAuditoriaEditPrueba010") })
                            @Html.ValidationMessageFor(model => model.id_criticidad_programa_trabajo, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>

                <div class="row forIncident" @(Model.tiene_incidencia ? "" : "hidden=hidden")>
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("BDEICreate005")</label>
                        <div class="col-xs-6 col-md-5">
                            @Html.DropDownList("id_estatus_programa_trabajo", null, Strings.getMSG("RevisionControlCreate108"), htmlAttributes: new { @class = "form-control", @title = Strings.getMSG("Atencion"), data_toggle = "popover", data_trigger = "hover", data_content = @Strings.getMSG("ProcesosAuditoriaEditPrueba011") })
                            @Html.ValidationMessageFor(model => model.id_estatus_programa_trabajo, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>

                <div class="row forIncident" @(Model.tiene_incidencia ? "" : "hidden=hidden")>
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("ProcesosAuditoriaEditPrueba004")</label>
                        <div class="col-xs-6 col-md-5">
                            <div class="input-group">
                                @Html.EditorFor(model => model.tema, new { htmlAttributes = new { @class = "form-control" } })
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("ProcesosAuditoriaEditPrueba012")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                            @Html.ValidationMessageFor(model => model.tema, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>

                <div class="row forIncident" @(Model.tiene_incidencia ? "" : "hidden=hidden")>
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("Responsable")</label>
                        <div class="col-xs-6 col-md-5">
                            <div class="input-group">
                                @Html.EditorFor(model => model.tema, new { htmlAttributes = new { @class = "form-control" } })
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("ProcesosAuditoriaEditPrueba013")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                            @Html.ValidationMessageFor(model => model.tema, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>

                <div class="row forIncident" @(Model.tiene_incidencia ? "" : "hidden=hidden")>
                    <div class="form-group">
                        <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("ProcesosAuditoriaEditPrueba005")</label>
                        <div class="col-xs-3 col-md-2">
                            <div class="input-group">
                                @Html.EditorFor(model => model.es_duplicada, new { htmlAttributes = new { data_toggle = "toggle", data_on = Strings.getMSG("AjustesMailIndex015"), data_off = Strings.getMSG("AjustesMailIndex016"), data_width = "140" } })
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("ProcesosAuditoriaEditPrueba014")">
                                        <i class="glyphicon glyphicon-question-sign"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="tab-pane" id="pes2">

            <div class="form-horizontal well">
                <h4>@Strings.getMSG("ProcesosAuditoriaCreatePlaneacion014")</h4>
                <hr />

                @foreach (var campo in InfoCamposExtra)
                {
                    var val = "";
                    if (DCE.ContainsKey(campo.id_campo_programa))
                    {
                        val = DCE[campo.id_campo_programa];
                    }

                    <div class="row">
                        <div class="form-group @(campo.es_requerido ? "has-error":"") ">
                            <label class="control-label col-xs-3 col-md-2">@campo.nb_campo</label>
                            <div class="col-xs-6 col-md-5">

                                @if (campo.cl_tipo_campo == "t")
                                {
                                    <div class="input-group">
                                        <input class="form-control text-box single-line" style=" @(campo.cl_color_borde == "0" ? "" : "border-color:" + campo.cl_color_borde+";") @(campo.cl_color_fondo == "0" ? "" : "background-color:" + campo.cl_color_fondo+";") " data-val="true" data-val-length="Este campo puede tener hasta @campo.longitud caracteres." data-val-length-max="@campo.longitud" name="campoe[]" type="text" value="@val">
                                        <div class="input-group-btn">
                                            <button type="button" class="btn btn-default" title="" data-toggle="popover" data-trigger="hover" data-content="@(campo.msg_ayuda)." data-original-title="@Strings.getMSG("Atencion")">
                                                <i class="glyphicon glyphicon-question-sign"></i>
                                            </button>
                                        </div>
                                    </div>
                                }
                                else if (campo.cl_tipo_campo == "a")
                                {
                                    <textarea class="form-control" style=" @(campo.cl_color_borde == "0" ? "" : "border-color:" + campo.cl_color_borde+";") @(campo.cl_color_fondo == "0" ? "" : "background-color:" + campo.cl_color_fondo+";") " cols="20" data-content="@(campo.msg_ayuda)." data-toggle="popover" data-trigger="hover" data-val="true" data-val-length="La descripción puede tener hasta @campo.longitud caracteres." data-val-length-max="@campo.longitud" name="campoe[]" rows="5" title="" data-original-title="@Strings.getMSG("Atencion")">@val</textarea>
                                }
                                else if (campo.cl_tipo_campo == "n")
                                {
                                    <div class="input-group">
                                        <input class="form-control text-box single-line" style=" @(campo.cl_color_borde == "0" ? "" : "border-color:" + campo.cl_color_borde+";") @(campo.cl_color_fondo == "0" ? "" : "background-color:" + campo.cl_color_fondo+";") " data-val="true" data-val-number="Este campo debe ser numérico" name="campoe[]" type="number" value="@val">
                                        <div class="input-group-btn">
                                            <button type="button" class="btn btn-default" title="" data-toggle="popover" data-trigger="hover" data-content="@(campo.msg_ayuda)." data-original-title="@Strings.getMSG("Atencion")">
                                                <i class="glyphicon glyphicon-question-sign"></i>
                                            </button>
                                        </div>
                                    </div>
                                }

                                <input type="hidden" name="idcampoe[]" value="@campo.id_campo_programa" />

                                @if (Errors.ContainsKey(campo.id_campo_programa))
                                {
                                    <span class="field-validation-valid text-danger">@Errors[campo.id_campo_programa]</span>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>



        </div>

    </div>

    <div class="row">
        <div class="form-group">
            <div class="col-xs-offset-2 col-xs-6 col-md-5">
                <input type="submit" value="@Strings.getMSG("Guardar")" class="btn btn-primary" />
                @Html.ActionLink(Strings.getMSG("Regresar"), "PruebasEjecucion", null, new { id = Model.idd_auditoria }, new { @class = "btn btn-default" })
            </div>
        </div>
    </div>

    <select multiple id="files" name="files" hidden></select>

}

<br />
<br />
<br />
<div class="form-horizontal well">
    <h4>@Strings.getMSG("RevisionControlRevisiones003")</h4>
    <hr />

    <div class="row">
        <label class="control-label col-xs-3 col-sm-2 col-md-2 col-lg-2">@Strings.getMSG("lyPIndex027")</label>
        <div class="col-xs-9 col-sm-10 col-md-10 col-lg-10">
            <form action="@Url.Action("Upload","Archivos")"
                  class="dropzone"
                  data-target="files"
                  id="fileUploader"></form>
            <!--data-target es el elemento select multiple a donde se agregaran los ids de los archivos elegidos-->
            <!--el id siempre debera ser fileUploader-->
        </div>
    </div>


    <br /><br /><br />

    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th>@Strings.getMSG("RevisionControlRevisiones006")</th>
                <th>@Strings.getMSG("BDEIIndex003")</th>
                <th width="80px"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var file in Model.c_archivo)
            {
                <tr id="fr@(file.id_archivo)">
                    <td>@file.nb_archivo</td>
                    <td>@file.fe_alta.Value.ToString("dd/MM/yyyy hh:mm:ss")</td>
                    <td>
                        <center>
                            <a href="@Url.Action("Download","Archivos", new { id = file.id_archivo})"><i class="fa fa-download" title="@Strings.getMSG("Descargar")"></i></a>|
                            <a onclick="deleteFile(@file.id_archivo,'@file.nb_archivo')"><i class="fa fa-trash" title="@Strings.getMSG("Borrar")"></i></a>
                        </center>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
