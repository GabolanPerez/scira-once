@model IEnumerable<SCIRA.Models.c_auditoria>
@using SCIRA.Utilidades
@using SCIRA.Utilidades
@using SCIRA.Seguridad

@{
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    ViewBag.Title = Strings.getMSG("GraphicsAuditoriandex002");
    List<int> años = ViewBag.años;


    var AudReg = Model.Where(a => a.es_regulada);
    var AudNoReg = Model.Where(a => !a.es_regulada);

    bool RegTitleSet = false;
    bool NoRegTitleSet = false;
}

<style>
    td.hover {
        font-weight: bold;
        transition: all linear .05s;
    }

        td.hover:hover {
            opacity: 0.5;
        }
</style>


<script>
    var baseUrl = "@Url.Action("Details","GraphicsSeguimientoAuditoria")/?id="

    var options = {
        title: "@Strings.getMSG("Informe Definitivo")",
        size: "lg",
        show: true,
        loadUrl: ""
    };


    function Details(idd_aud) {
        options.loadUrl = baseUrl + idd_aud;
        menuModal.initModal(options);
    }
</script>

<h2>@ViewBag.title</h2>


<table class="table table-striped table-bordered">
    <thead>
        <tr>

            <th style="font-weight:bold;">@Strings.getMSG("GraphicsAuditoriandex007")</th>
            <th></th>
            @foreach (var año in años)
            {
                <th>@año</th>
            }
            <th>@Strings.getMSG("CalificacionArea001")</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var aud in AudReg)
        {

            <tr>
                <td>@(!RegTitleSet ? Strings.getMSG("GraphicsAuditoriandex008") :"")</td>

                <td>@aud.nb_auditoria</td>


                @foreach (var año in años)
                {
                    var kAud = aud.k_auditoria.FirstOrDefault(k => k.fe_inicial_planeada.Value.Year == año);
                    var color = "";
                    var clave = "";
                    try { color = kAud.c_rating_auditoria.cl_color_campo; } catch { }
                    try { clave = kAud.c_rating_auditoria.calificacion; } catch { }

                    <td class="hover" style="background-color:@color;text-align:center;color:white;" @(color != "" ? "onclick=Details(" + kAud.idd_auditoria + ")" : "")>@clave</td>
                }
                <td class="resaltable" style="color:@aud.cl_color_campo;font-size: 2rem;background-color:white;" onclick="mpDetail(@aud.id_auditoria);"><center>▰</center> </td>
            </tr>


            RegTitleSet = true;
        }

        @foreach (var aud in AudNoReg)
        {

            <tr>

                <td>@(!NoRegTitleSet ? Strings.getMSG("GraphicsAuditoriandex009") :"")</td>

                <td>@aud.nb_auditoria</td>

                @foreach (var año in años)
                {
                    var kAud = aud.k_auditoria.FirstOrDefault(k => k.fe_inicial_planeada.Value.Year == año);
                    var color = "";
                    var clave = "";
                    try { color = kAud.c_rating_auditoria.cl_color_campo; } catch { }
                    try { clave = kAud.c_rating_auditoria.calificacion; } catch { }

                    <td class="hover" style="background-color:@color;text-align:center;color:white;" @(clave != "" ? "onclick=Details(" + kAud.idd_auditoria + ")" : "")>@clave</td>
                }
                <td class="resaltable" style="color:@aud.cl_color_campo;font-size: 2rem;background-color:white;"> <center>▰</center> </td>
            </tr>


            NoRegTitleSet = true;
        }


    </tbody>

</table>

<br>
<br>
<br>

<div id="CriticidadRiesgo">
</div>

<script>

    function mpDetail(id) {

        $("#menuModal .HeadLabel").html("@Strings.getMSG("CalificacionArea001") " + $(".u" + id).text());
        $("#menuModal .partialModal").html('<div class="row"><div class="col-md-offset-5 col-xs-offset-1 col-md-1 col-xs-1"><span id="ind1" class="IndicatorLoader centered"></span></div></div>');
        $("#menuModal").modal('show');
        $("#menuModal .partialModal").load('@(Url.Action("DetailsCosVista", "GraphicsSeguimientoAuditoria"))/' + id);

    }

</script>