@using SCIRA.Utilidades
@{
    ViewBag.Title = Strings.getMSG("GraphicsCosteoIndex009") ;
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
}
<script src="~/Scripts/chart.js"></script>
<script src="~/Scripts/graphics.js"></script>
<link href="~/Content/Extras.css" rel="stylesheet" />
<link href="~/Content/bootstrap-select.min.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-select.js"></script>
<script src="~/Scripts/MSInitialize.js"></script>
<link href="~/Content/bootstrap-toggle.min.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-toggle.min.js"></script>
<script src="~/Scripts/sharedScripts.js"></script>
<script>
    var options1 = {
        elements: {
            rectangle: {
                borderWidth: 2,
            }
        },
        responsive: true,
        legend: {
            position: 'right',
        },
        title: {
            display: true,
            text: 'Chart.js Horizontal Bar Chart'
        }
    };

    var options2 = {
        responsive: true,
        title: {
            display: true,
            text: 'title'
        }
    };

    var g0;
    var gr0;
    var tg0 = 'horizontalBar';
    var opt0 = options1;

    //filtros para grafica general
    var entidades = [];

    //Datos para la gráfica general
    var data0 = @Html.Raw(ViewBag.d0);



    $(document).ready(function () {
        g0 = $("#g0");
        gr0 = buildChart(data0, tg0, "@Strings.getMSG("GraphicsBDEIIndex005")", g0, opt0);


        //funciones al hacer clic en los elementos de la gráica 0;
        document.getElementById("g0").onclick = function (evt) {
            var activePoints = gr0.getElementsAtEvent(evt);
            if (activePoints[0]) {
                var Moneda = $('select[name="moneda"] option:selected').text()
                $("#modalH").html("<center>@Strings.getMSG("GraphicsBDEIIndex009")<br/>Miles de " + @Strings.getMSG("Menu042") + "</center>");
                $("#modalB").html('<div class="row"><div class="col-md-offset-5 col-xs-offset-1 col-md-1 col-xs-1"><span id="ind1" class="IndicatorLoader centered"></span></div></div>')
                $("#aviso").modal('show');

                url = '@(Url.Action("Details", "GraphicsBDEI"))';

                $.ajax({
                    dataType: "html",
                    type: "post",
                    cache: false,
                    url: url,
                    data: $("#form1").serialize(),
                    success: function (data) {
                        $("#modalB").html(data);
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        $("#modalB").modal('hide');
                        toastr.error("@Strings.getMSG("GraphicsMRyCIndex020")");
                    }
                });
            }
        };

        $('.custom-picker').on('hide.bs.dropdown', function (e) {
            var b1 = false;

            var nentidades = $('#entidades').val();


            if (nentidades != null) {
                nentidades.forEach(function (elemento) {
                    if (!entidades.includes(elemento)) {
                        b1 = true;
                    }
                });
                entidades.forEach(function (elemento) {
                    if (!nentidades.includes(elemento)) {
                        b1 = true;
                    }
                });
            } else {
                if (entidades.length != 0) {
                    b1 = true;
                }
                nentidades = [];
            }
            if (b1) {
                entidades = nentidades;
            }

            if (b1) loadFilters();
        });

    });

    function loadFilters() {
        $.ajax({
            dataType: "html",
            type: "post",
            cache: false,
            url: '@(Url.Action("loadFilters", "GraphicsBDEI"))',
            data: $("#form1").serialize(),
            success: function (data) {
                $("#contenedor1").html(data);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                toastr.error("@Strings.getMSG("GraphicsMRyCIndex020")");
            }
        });
    }

</script>


<div id="contenedor1"></div>

<div class="modal fade" id="aviso" tabindex="-1" role="dialog" aria-labelledby="Aviso" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="font-size: 2em;" id="modalH">

            </div>
            <div id="modalB" class="modal-body">

            </div>
            <div id="modalF" class="modal-footer">

            </div>
        </div>
    </div>
</div>
<h2>@ViewBag.Title @Strings.getMSG("Menu146")</h2> @Strings.getMSG("GraphicsBDEIIndex006")

<div class="form-horizontal well">
    <canvas id="g0" width="424" height="212" style="width: 424px; height: 212px;"></canvas>
    <button id="ctp" class="btn btn-default" onclick="gr0.destroy(); tg0 = 'pie'; opt0 = options2; gr0 = buildChart(data0, tg0, 'MRyC', g0, opt0); $('#ctb').show(); $('#ctp').hide();">@Strings.getMSG("GraphicsMRyCIndex019")</button>
    <button id="ctb" class="btn btn-default" onclick="gr0.destroy(); tg0 = 'horizontalBar'; opt0 = options1; gr0 = buildChart(data0, tg0, 'MRyC', g0, opt0); $('#ctp').show();  $('#ctb').hide()" style="display:none;">@Strings.getMSG("GraphicsMRyCIndex012")</button>



    <h4>Filtros</h4>
    <form id="form1">
        <div class="form-horizontal">
            <div class="row">
                <div class="form-group">
                    <label class="control-label col-xs-3 col-md-1">@Strings.getMSG("Entidad")</label>
                    <div class="col-xs-3 col-md-3">
                        <div class="input-group">
                            @Html.ListBox("entidades", (MultiSelectList)ViewBag.entidades, htmlAttributes: new { @class = "form-control selectpicker custom-picker", @id = "entidades", @name = "entidades" })
                            <div class="input-group-btn">
                                <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("GraphicsMRyCIndex007")">
                                    <i class="glyphicon glyphicon-question-sign"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label class="control-label col-xs-3 col-md-1">@Strings.getMSG("GraphicsBDEIIndex004")</label>
                    <div class="col-xs-3 col-md-3">
                        @Html.DropDownList("moneda", null, htmlAttributes: new { @class = "form-control", @title = Strings.getMSG("Atencion"), data_toggle = "popover", data_trigger = "hover", data_content = Strings.getMSG("GraphicsMRyCIndex007"), @onchange = "loadFilters();" })
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>




