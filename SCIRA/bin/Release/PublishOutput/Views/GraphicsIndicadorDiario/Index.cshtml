@model IEnumerable<SCIRA.Models.c_contenido_grupo>
@using SCIRA.Utilidades
@{
    ViewBag.Title = @Strings.getMSG("GraphicsIndicadorDiarioIndex020");
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    var db = new SCIRA.Models.SICIEntities();
    string ruta = "";

}

<!-- #region Librerias -->
<script src="~/Scripts/chart.js"></script>
<script src="~/Scripts/graphics.js"></script>
<link href="~/Content/Extras.css" rel="stylesheet" />
<link href="~/Content/bootstrap-select.min.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-select.js"></script>
<script src="~/Scripts/MSInitialize.js"></script>
<link href="~/Content/bootstrap-toggle.min.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-toggle.min.js"></script>
<!-- #endregion -->
<!-- #region Estilos Gráficas -->
<style type="text/css">
    .contentG11 {
        width: 50%;
        height: 50%;
        align-items: center;
        justify-content: center;
        float: left;
        display: block;
    }
</style>
<!-- #endregion -->
<!-- #region Scripts Gráficas -->

<script>
    var options1 = {
        responsive: true,
        title: {
            display: true,
            text: 'title'
        }
    };

    //declaración de variables
    var g1;
    var gr1;
    var tg1 = 'line';
    var opt1 = options1;

    var g2;
    var gr2;
    var tg2 = 'line';
    var opt2 = options1;

    var g3;
    var gr3;
    var tg3 = 'line';
    var opt3 = options1;

    var g4;
    var gr4;
    var tg4 = 'line';
    var opt4 = options1;

    var data1 = @Html.Raw(ViewBag.d3);
    var data2 = @Html.Raw(ViewBag.d2);
    var data3 = @Html.Raw(ViewBag.d1);
    var data4 = @Html.Raw(ViewBag.d4);


    $(document).ready(function () {

        g1 = $("#g1");
        gr1 = buildChart(data1, tg1, "@Strings.getMSG("GraphicsIndicadorIndex008")", g1, opt1, 'red');

        g2 = $("#g2");
        gr2 = buildChart(data2, tg2, "@Strings.getMSG("GraphicsBDEIIndex013")", g2, opt2, 'yellow');

        g3 = $("#g3");
        gr3 = buildChart(data3, tg3, "@Strings.getMSG("GraphicsBDEIIndex014")", g3, opt3, 'green');

        g4 = $("#g4");
        gr4 = buildChart(data4, tg4, "@Strings.getMSG("GraphicsBDEIIndex015")", g4, opt4, 'cornflowerblue');

        //funciones al hacer clic en los elementos de la gráfica 1;
        document.getElementById("g1").onclick = function (evt) {
            var activePoints = gr1.getElementsAtEvent(evt);
            if (activePoints[0]) {
                var chartData = activePoints[0]['_chart'].config.data;
                var idx = activePoints[0]['_index'];
                var label = chartData.labels[idx];
                //var value = chartData.datasets[0].data[idx];
                var id = chartData.datasets[0].id;

                detailsGraph(label, 3);
            }
        };

        //funciones al hacer clic en los elementos de la gráfica 2;
        document.getElementById("g2").onclick = function (evt) {
            var activePoints = gr2.getElementsAtEvent(evt);
            if (activePoints[0]) {
                var chartData = activePoints[0]['_chart'].config.data;
                var idx = activePoints[0]['_index'];
                var label = chartData.labels[idx];
                //var value = chartData.datasets[0].data[idx];
                var id = chartData.datasets[0].id;

                detailsGraph(label, 2);
            }
        };

        //funciones al hacer clic en los elementos de la gráfica 3;
        document.getElementById("g3").onclick = function (evt) {
            var activePoints = gr3.getElementsAtEvent(evt);
            if (activePoints[0]) {
                var chartData = activePoints[0]['_chart'].config.data;
                var idx = activePoints[0]['_index'];
                var label = chartData.labels[idx];
                //var value = chartData.datasets[0].data[idx];
                var id = chartData.datasets[0].id;

                detailsGraph(label, 1);
            }
        };

        //funciones al hacer clic en los elementos de la gráfica 4;
        document.getElementById("g4").onclick = function (evt) {
            var activePoints = gr4.getElementsAtEvent(evt);
            if (activePoints[0]) {
                var chartData = activePoints[0]['_chart'].config.data;
                var idx = activePoints[0]['_index'];
                var label = chartData.labels[idx];
                //var value = chartData.datasets[0].data[idx];
                var id = chartData.datasets[0].id;

                detailsGraph(label, 4);
            }
        };

    });


</script>

<!-- #endregion -->
<!-- #region Scripts Filtros -->
<script>
    //filtros para grafica general
    var areas = [];
    var usuarios = [];
    var indicadores = [];


    $(document).ready(function () {
        $('.custom-picker').on('hide.bs.dropdown', function (e) {
            var b1 = false;
            var b2 = false;
            var b3 = false;

            var nareas = $('#areas').val();
            var nusuarios = $('#usuarios').val();
            var nindicadores = $('#indicadores').val();


            if (nareas != null) {
                nareas.forEach(function (elemento) {
                    if (!areas.includes(elemento)) {
                        b1 = true;
                    }
                });
                areas.forEach(function (elemento) {
                    if (!nareas.includes(elemento)) {
                        b1 = true;
                    }
                });
            } else {
                if (areas.length != 0) {
                    b1 = true;
                }
                nareas = [];
            }
            if (b1) {
                areas = nareas;
            }

            if (nusuarios != null) {
                nusuarios.forEach(function (elemento) {
                    if (!usuarios.includes(elemento)) {
                        b2 = true;
                    }
                });
                usuarios.forEach(function (elemento) {
                    if (!nusuarios.includes(elemento)) {
                        b2 = true;
                    }
                });
            } else {
                if (usuarios.length != 0) {
                    b2 = true;
                }
                nusuarios = [];
            }
            if (b2) {
                usuarios = nusuarios;
            }

            if (nindicadores != null) {
                nindicadores.forEach(function (elemento) {
                    if (!indicadores.includes(elemento)) {
                        b3 = true;
                    }
                });
                indicadores.forEach(function (elemento) {
                    if (!nindicadores.includes(elemento)) {
                        b3 = true;
                    }
                });
            } else {
                if (indicadores.length != 0) {
                    b3 = true;
                }
                nindicadores = [];
            }
            if (b3) {
                indicadores = nindicadores;
            }


            if (b1 || b2 || b3) loadFilters();

        });
    });

    function loadFilters() {
        $.ajax({
            dataType: "html",
            type: "post",
            cache: false,
            url: '@(Url.Action("loadFilters", "GraphicsIndicadorDiario"))',
            data: $("#form1").serialize(),
            success: function (data) {
                $("#contenedor1").html(data);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                toastr.error("@Strings.getMSG("GraphicsBDEIIndex012")");
            }
        });
    }

</script>
<!-- #endregion -->

<h2>@Strings.getMSG("GraphicsIndicadorDiarioIndex003")</h2>

<br />
<br />


<center>
    <span class="label bc1">@Strings.getMSG("Bueno")</span>
    <span class="label bc2">@Strings.getMSG("Regular")</span>
    <span class="label bc3">@Strings.getMSG("Malo")</span>
    <span class="label bc4">@Strings.getMSG("No Calificado")</span>
    <span class="label bc5">@Strings.getMSG("GraphicsIndicadorDiarioIndex021")</span>
</center>


<ul class="nav nav-tabs">
    <li class="active"><a href="#pes0" data-toggle="tab"><h4>@Strings.getMSG("GraphicsIndicadorDiarioIndex001")<span id="ind1"></span> </h4></a></li>
    <li><a href="#pes1" data-toggle="tab"><h4>@Strings.getMSG("GraphicsIndicadorDiarioIndex002")<span id="ind1"></span> </h4></a></li>
</ul>
<div id="myTabContent" class="tab-content">
    <div class="tab-pane fade active in" id="pes0">
        <div class="well">
            <div id="ContenidoGrupo"></div>
        </div>
    </div>

    <div class="tab-pane" id="pes1">
        <div class="form-horizontal well">


            <div class="row col-md-12">
                <div class="col-md-6"><div class=""> <canvas id="g1" width="424" height="212" style="width: 424px; height: 212px;"></canvas> </div></div>
                <div class="col-md-6"><div class=""> <canvas id="g2" width="424" height="212" style="width: 424px; height: 212px;"></canvas></div></div>
                <div class="col-md-6"><div class=""> <canvas id="g3" width="424" height="212" style="width: 424px; height: 212px;"></canvas></div></div>
                <div class="col-md-6"><div class=""> <canvas id="g4" width="424" height="212" style="width: 424px; height: 212px;"></canvas></div></div>
            </div>

            <h4>@Strings.getMSG("Filtros")</h4>
            <form id="form1">
                <div class="form-horizontal">

                    <div class="row">
                        <div class="row col-md-4">
                            <div class="row">
                                <div class="form-group col-md-12">
                                    <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("GraphicsIndicadorDiarioIndex022")</label>
                                    <div class="col-md-12">
                                        <div class="input-group">
                                            @Html.ListBox("areas", (MultiSelectList)ViewBag.areas, htmlAttributes: new { @class = "form-control selectpicker custom-picker" })
                                            <div class="input-group-btn">
                                                <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("GraphicsMRyCIndex007")">
                                                    <i class="glyphicon glyphicon-question-sign"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-md-12">
                                    <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("Usuario")</label>
                                    <div class="col-md-12">
                                        <div class="input-group">
                                            @Html.ListBox("usuarios", (MultiSelectList)ViewBag.usuarios, htmlAttributes: new { @class = "form-control selectpicker custom-picker" })
                                            <div class="input-group-btn">
                                                <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("GraphicsMRyCIndex007")">
                                                    <i class="glyphicon glyphicon-question-sign"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-md-12">
                                    <label class="control-label col-xs-3  col-md-2">@Strings.getMSG("Menu009")</label>
                                    <div class="col-md-12">
                                        <div class="input-group">
                                            @Html.ListBox("indicadores", (MultiSelectList)ViewBag.indicadores, htmlAttributes: new { @class = "form-control selectpicker custom-picker" })
                                            <div class="input-group-btn">
                                                <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("Atencion")Seleccione los elementos para realizar el filtrado de la información.">
                                                    <i class="glyphicon glyphicon-question-sign"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row col-md-8">
                            <div class="row">
                                <div class="form-group col-md-12">
                                    <label class="control-label col-xs-3 col-md-2">@Strings.getMSG("ContenidoGrupoCreate004")</label>
                                    <div class="col-md-12">
                                        <div class="col-md-6">
                                            <div class="input-group">
                                                <input type="text" id="nb_grupo" class="form-control" readonly value="" />

                                                <div class="input-group-btn">
                                                    <button type="button" class="btn btn-default" onclick="unpinGroup()" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("GraphicsIndicadorDiarioIndex023")">
                                                        <i class="fa fa-times"></i>
                                                    </button>

                                                    <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("GraphicsIndicadorDiarioIndex024")">
                                                        <i class="glyphicon glyphicon-question-sign"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="row">
                                <div id="ContenidoGrupo2"></div>
                            </div>
                        </div>
                    </div>

                    <input type="text" hidden id="id_grupo" name="id_grupo" value="" />
                    <input type="text" hidden id="tipo" name="tipo" />
                    <input type="text" hidden id="fe_eval" name="fe_eval" />
                </div>
            </form>
        </div>



    </div>
</div>




<div id="contenedor1"></div>


<!-- #region Styles -->
<style>
    .c1 {
        color: green;
    }

    .c2 {
        color: goldenrod;
    }

    .c3 {
        color: red;
    }

    .c4 {
        color: dodgerblue;
    }

    .c5 {
        color: slategrey;
    }

    .bc1 {
        background-color: green;
    }

    .bc2 {
        background-color: goldenrod;
    }

    .bc3 {
        background-color: red;
    }

    .bc4 {
        background-color: dodgerblue;
    }

    .bc5 {
        background-color: slategrey;
    }

    .label {
        font-size: 1em;
    }
</style>
<!-- #endregion -->
<!-- #region Scripts -->
<script>
    function details(id) {
        menuModal.initModal({
            title: '@Strings.getMSG("EvaluacionIndicadorDiarioIndex006")',
            size: 'lg',
            show: true,
            loadUrl: '@Url.Action("ContentDetails","GraphicsIndicadorDiario")/'+id
        });
    }

    function detailsGraph(fecha, tipo) {

        $("#tipo").val(tipo);
        $("#fe_eval").val(fecha);

        menuModal.initModal({
            title: '@Strings.getMSG("GraphicsIndicadorDiarioIndex025")',
            size: 'lg',
            show: true,
            loadUrl: '@Url.Action("GraphDetails","GraphicsIndicadorDiario")',
            formID: "form1"
        });
    }


    function loadContent(id) {
        $("#ContenidoGrupo").load("@Url.Action("ContenidoGrupo","GraphicsIndicadorDiario")/"+id);
    }

    function loadContent2(id) {
        $("#ContenidoGrupo2").load("@Url.Action("ContenidoGrupo2","GraphicsIndicadorDiario")/"+id);
    }

    $(document).ready(function () {
        $("#ContenidoGrupo").load("@Url.Action("ContenidoGrupo","GraphicsIndicadorDiario")");
        $("#ContenidoGrupo2").load("@Url.Action("ContenidoGrupo2","GraphicsIndicadorDiario")");
    });

    function pinGroup(id) {

        ruta = getFromURL("@Url.Action("ObtenerRutaINDD","Utilidades")/" + id);

        $("#nb_grupo").val(ruta);
        $("#id_grupo").val(id);

        loadFilters();
    }

    function unpinGroup() {

        $("#nb_grupo").val("");
        $("#id_grupo").val("");

        loadFilters();
    }



</script>
<!-- #endregion -->