@model IEnumerable<SCIRA.Models.k_certificacion_estructura>
@using SCIRA.Models
@using SCIRA.Utilidades
@{
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    ViewBag.Title = "Certificados del proceso";
    var db = new SICIEntities();

    c_periodo_certificacion periodo = ViewBag.periodo;
    var spc = ViewBag.spc;
    var spnc = ViewBag.spnc;
    c_proceso PR = ViewBag.PR;
    int id_periodo = 0;
    if (periodo != null)
    {
        id_periodo = periodo.id_periodo_certificacion;
    }

    bool puedeCertificar = ViewBag.puedeCertificar;
    bool CertificacionSegura = ViewBag.CertificacionSegura;
}
<link href="~/Content/font-awesome.min.css" rel="stylesheet" />

<script>
    var modalOptions = {
        title: "",
        size: "xl",
        show: true,
        loadUrl: ""
    }

    function info(tipo) {

        if (tipo == "spc") {
            modalOptions.title = "@Strings.getMSG("CertificacionesProceso002")";
            modalOptions.loadUrl = '@(Url.Action("spc"))/@(PR.id_proceso)';
        }
        if (tipo == "spnc") {
            modalOptions.title = "@Strings.getMSG("CertificacionesProceso003")";
            modalOptions.loadUrl = '@(Url.Action("spnc"))/@(PR.id_proceso)';
        }
        menuModal.initModal(modalOptions);
    }
</script>



<h2>@Strings.getMSG("CertificacionInforme016") @PR.nb_proceso</h2>

<p>
    @if (puedeCertificar.ToString() == "True" && !Model.Any(c => c.id_periodo_certificacion == id_periodo))
    {
        @Html.ActionLink(Strings.getMSG("Agregar"), "Certificar", new { @id = PR.id_proceso }, new { @class = "btn btn-default btn-sm" });
    }
@Html.ActionLink(Strings.getMSG("Regresar"), "Index", null, new { @class = "btn btn-default btn-sm" })

@if (CertificacionSegura)
{
    <button type="button" class="btn btn-default pull-right" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("CertificacionInforme010")">
        <i class="fa fa-lock"></i>
    </button>
}
</p>

<div class="row">
    <div class="card-group" style="margin:0 0 20px 0">
        <div class="card">
            <div class="card-header text-center" style="font-size:1.7rem;font-weight:bold;">@Strings.getMSG("CertificacionesEntidad001")</div>
            <div class="card-body text-center" style="font-size:1.6rem">
                @if (periodo != null)
                {
                    @(periodo.nb_periodo_certificacion + " - " + periodo.anio)
                }
                else
                {
                    @("N/A")
                }
            </div>
        </div>
        <div class="card hover" onclick="info('spc');">
            <div class="card-header text-center" style="font-size:1.7rem;font-weight:bold;">@Strings.getMSG("CertificacionesProceso002")</div>
            <div class="card-body text-center" style="font-size:1.6rem">
                @(spc)
            </div>
        </div>
        <div class="card hover" onclick="info('spnc');">
            <div class="card-header text-center" style="font-size:1.7rem;font-weight:bold;">@Strings.getMSG("CertificacionesProceso003")</div>
            <div class="card-body text-center" style="font-size:1.6rem">
                @(spnc)
            </div>
        </div>
    </div>
</div>
<table id="results" class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th class="search">@Strings.getMSG("PeriodoCertificacionIndex002")</th>
            <th>@Strings.getMSG("CertificacionesEntidad005")</th>
            <th style="word-wrap: break-word">@Strings.getMSG("lyPSeguimientoCreate002")</th>
            <th>@Strings.getMSG("CertificacionesEntidad006")</th>
            <th width="90">@Strings.getMSG("CertificacionesEntidad007")</th>
            <th width="80"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            bool nsc = false; //Nivel Superior Certificado

            //certificación del nivel superior
            var certNS = item.c_proceso.c_macro_proceso.k_certificacion_estructura.FirstOrDefault(c => c.id_periodo_certificacion == item.id_periodo_certificacion);
            if (certNS != null)
            {
                nsc = true;
            }

        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.c_periodo_certificacion.nb_periodo_certificacion)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.leyenda_certificacion_estructura)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.comentarios)
            </td>
            <td>
                @(item.resultado ? Strings.getMSG("AjustesMailIndex015"):Strings.getMSG("AjustesMailIndex016"))
            </td>
            <td>
                @foreach (var file in item.c_archivo)
                {
                    <a href="@Url.Action("Download","Archivos", new { id = file.id_archivo})"><i class="fa fa-file@(Utilidades.getFileClass(file))" title="@file.nb_archivo"></i></a>
                }
                @if (item.c_archivo.Count() == 0)
                {
                    @:@Strings.getMSG("CertificacionesEntidad010")
                }
            </td>
            <td>
                @if (id_periodo == item.id_periodo_certificacion)
                {
                    <a href="@Url.Action("Edit", new { id = item.id_certificacion_estructura })">
                        <i class="glyphicon glyphicon-pencil" title="@Strings.getMSG("Editar")"></i>
                    </a>
                    @:|
                }
                @if (nsc)
                {
                    <button disabled>
                        <i class="glyphicon glyphicon-trash" title="@Strings.getMSG("CertificacionInforme012")"></i>
                    </button>
                }
                else
                {
                    <a href="@Url.Action("Delete", new { id = item.id_certificacion_estructura })">
                        <i class="glyphicon glyphicon-trash" title="@Strings.getMSG("Borrar")"></i>
                    </a>
                }
            </td>
        </tr>
        }
    </tbody>
</table>
