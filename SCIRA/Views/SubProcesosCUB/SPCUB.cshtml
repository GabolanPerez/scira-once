@model SCIRA.ViewModels.SPCUBViewModel
@using SCIRA.Utilidades
@{
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    ViewBag.Title = "Sub Procesos";
}
<script src="~/Scripts/sharedScripts.js"></script>
<link href="~/Content/AnimacionCarga.css" rel="stylesheet" />
<link href="~/Content/bootstrap-select.min.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-select.js"></script>

<script>
    $(document).ready(function () {
    $('.selectpicker').selectpicker({
        style: 'btn-default',
        liveSearch: 'true',
        noneSelectedText: '@Strings.getMSG("IndicadorDiarioCreate008")',
        actionsBox: 'false',
        deselectAllText: '@Strings.getMSG("Deseleccionar todos")',
        selectAllText: '@Strings.getMSG("Seleccionar todos")',
        selectedTextFormat: 'count > 1',
        size: 'auto',
        countSelectedText: "{0} @Strings.getMSG("OBS")"
        });
    });


    var global = 0;
    var clave = "";

    function setSP(id) {
        var nb_sub_proceso = $("#" + id + "sp").val();
        $('#cajaSubProcesos').find('option[value="' + id + '"]').remove();
        $('#cajaSubProcesos').append('<option value="' + id + '" selected="selected">' + nb_sub_proceso + '</option>');
        $('.selectpicker').selectpicker('refresh');
    }

    function setNM(id) {
        var nb_normatividad = $("#" + id + "nm").val();
        $('#cajaContenidos').find('option[value="' + id + '"]').remove();
        $('#cajaContenidos').append('<option value="' + id + '" selected="selected">' + clave + nb_normatividad + '</option>');
        $('.selectpicker').selectpicker('refresh');
    }

    function loadContent(id) {
        $("#contenido").load( '@(Url.Action("Contenido","SubProcesosCUB",null))?id=' + id);
    }

    function loading() {
        deshabilitar();
        $("body").addClass('loading');
    }
</script>
<h2>@Strings.getMSG("Menu091")</h2>

<br /><br />
@using (Html.BeginForm(null, null, FormMethod.Post, new { onsubmit = "loading()" }))
{
    <!--Agregar el modelo que acepte los id's del SP y de la Normatividad-->

    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <div class="row">
            <div class="form-group">
                <label class="control-label col-md-1">@Strings.getMSG("SP")</label>
                <div class="col-md-4">
                    <div class="input-group">
                        <select id="cajaSubProcesos" name="spids" class="selectpicker" multiple="multiple"></select>
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("SubProcesosCUBSPCUBCreate003")">
                                <i class="glyphicon glyphicon-question-sign"></i>
                            </button>
                        </div>
                    </div>
                    @Html.ValidationMessageFor(model => model.spids, "", new { @class = "text-danger" })
                </div>

                <label class="control-label col-md-1">@Strings.getMSG("Menu015")</label>
                <div class="col-md-4">
                    <div class="input-group">
                        <select id="cajaContenidos" name="nmids" class="selectpicker" multiple="multiple"></select>
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("SubProcesosCUBSPCUBCreate005")">
                                <i class="glyphicon glyphicon-question-sign"></i>
                            </button>
                        </div>
                    </div>
                    @Html.ValidationMessageFor(model => model.nmids, "", new { @class = "text-danger" })
                </div>
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <div class="col-md-3 col-md-push-6 pull-rigth">
                    <input type="submit" value="@Strings.getMSG("Guardar")" class="btn btn-primary" id="submit" />
                    @Html.ActionLink(Strings.getMSG("Regresar"), "Index", "SubProcesosCUB", "", new { @class = "btn btn-default btn-sm" })
                </div>
            </div>
        </div>
    </div>
}

<br /><br />

<ul class="nav nav-tabs">
    <li class="active"><a href="#SubProcesos" data-toggle="tab"><h4>@Strings.getMSG("SPS")</h4></a></li>
    <li><a href="#Normatividades" data-toggle="tab"><h4>@Strings.getMSG("Menu016")</h4></a></li>
</ul>

<div id="myTabContent" class="tab-content">

    <div class="tab-pane fade active in" id="SubProcesos">
        <br />
        <table id="results" class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th class="search">@Strings.getMSG("Entidad")</th>
                    <th class="search">@Strings.getMSG("MP")</th>
                    <th class="search">@Strings.getMSG("P")</th>
                    <th class="search">@Strings.getMSG("SP")</th>
                    <th width="75"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.SubProcesos)
                {
                    <tr>
                        <td>
                            @(item.cn_entidad)
                        </td>
                        <td>
                            @(item.cn_macro_proceso)
                            <input type="text" hidden id="@(item.id_sub_proceso)sp" value="@item.cn_sub_proceso">
                        </td>
                        <td>
                            @(item.cn_proceso)
                        </td>
                        <td>
                            @(item.cn_sub_proceso)
                        </td>
                        <td>
                            <center>
                                <a href=# onclick="setSP(@item.id_sub_proceso)">
                                    <i class="glyphicon glyphicon-pushpin" title="@Strings.getMSG("Seleccionar Sub Proceso")"></i>
                                </a>
                            </center>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="tab-pane" id="Normatividades">
        <div id="contenido">
            <br />
            @{Html.RenderPartial("Normatividades", Model.Contenido_Normatividad);}
        </div>
    </div>

</div>