@using Newtonsoft.Json.Linq;
@model JObject
@using SCIRA.Utilidades

@{
    string repName = Model.Property("RepName").Value.ToString();
    int noCols = int.Parse(Model.Property("NoCols").Value.ToString());
    bool enableHeadConfig = Model.Property("enableHeadConfig").Value.ToString() == "True" ? true : false;

    JArray ColNames = (JArray)Model["ColNames"];
    JArray Rows = (JArray)Model["Rows"];

    string title = repName;

    if (title.Length > 50)
    {
        title = title.Substring(0, 47) + "...";
    }

    ViewBag.Title = title + " del " + ViewBag.folder ;
    Layout = "~/Views/Shared/_LayoutReporte.cshtml";

    int nCells;

    if (enableHeadConfig)
    {
        try
        {
            nCells = Rows[0].Count();
        }
        catch
        {
            nCells = noCols;
        }
    }
    else
    {
        nCells = noCols;
    }


}

<script>
    @*$(document).ready(function () {
        var repname = $("<div/>").html("@repName").text();
        repname = repname.substr(0, 180);

        document.title = repname + "... del @ViewBag.folder";
    });*@
</script>

<h2>@(repName + " del " + ViewBag.folder)</h2>

<div class="row">
    <div class="form-group">
        <div class="col-xs-6 col-md-5">
            @Html.ActionLink(Strings.getMSG("Regresar"), "ReportList", new { folder = ViewBag.folder }, new { @class = "btn btn-default" })
        </div>
    </div>
</div>

<table class="results table table-striped table-bordered table-hover">
    <thead>
        @if (enableHeadConfig)
        {
            nCells = 0;
            int NoRowsHeader = int.Parse(Model.Property("NoRowsHeader").Value.ToString());
            JArray HeadConfig = (JArray)Model["HeadConfig"];
            var noHeadConfigs = HeadConfig.Count;
            for(int i = 0;i < NoRowsHeader; i++)
            {
                @:<tr role="row">
                for (int j = 0; j < noHeadConfigs; j++)
                {
                    JObject config = (JObject)HeadConfig[j];
                    int nFila = int.Parse(config.Property("noFila").Value.ToString());
                    int rowSpan = int.Parse(config.Property("rowspan").Value.ToString());
                    int colSpan = int.Parse(config.Property("colspan").Value.ToString());
                    
                    if(nFila == i + 1)
                    {
                        
                        string cn = ColNames[j].ToString();
                        <th colspan="@(colSpan)" rowspan="@(rowSpan)">@cn</th>
                        if (i == 0) { nCells += colSpan; }
                    }
                }
                @:</tr>
            }

        }
        else
        {
        <tr>
            @for(int i = 0;i < noCols;i++)
            {
                string cn = ColNames[i].ToString();
                <th>@cn</th>
            }
        </tr>
        }
    </thead>
    <tbody>
        @foreach(JArray row in Rows)
        {
        <tr>
            @for(int i = 0;i < nCells;i++)
            {
                string cell = row[i].ToString();
                <td>@cell</td>
            }
        </tr>
        }
    </tbody>
</table>
