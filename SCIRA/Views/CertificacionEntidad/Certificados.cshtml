@model IEnumerable<SCIRA.Models.k_certificacion_estructura>
@using SCIRA.Models
@using SCIRA.Utilidades
@{
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    ViewBag.Title = "Certificados de la entidad";
    var db = new SICIEntities();

    c_periodo_certificacion periodo = ViewBag.periodo;
    var mpc = ViewBag.mpc;
    var mpnc = ViewBag.mpnc;
    c_entidad entidad = ViewBag.Entidad;
    int id_periodo = 0;
    if (periodo != null)
    {
        id_periodo = periodo.id_periodo_certificacion;
    }

    bool puedeCertificar = ViewBag.puedeCertificar;
    bool CertificacionSegura = ViewBag.CertificacionSegura;
}
<link href="~/Content/font-awesome.min.css" rel="stylesheet" />

<script>
    var modalOptions = {
        title: "",
        size: "xl",
        show: true,
        loadUrl: ""
    }

    function info(tipo) {

        if (tipo == "mpc") {
            modalOptions.title = "@Strings.getMSG("CertificacionesEntidad002")";
            modalOptions.loadUrl = '@(Url.Action("mpc"))/@(entidad.id_entidad)';
        }
        if (tipo == "mpnc") {
            modalOptions.title = "@Strings.getMSG("CertificacionesEntidad003")";
            modalOptions.loadUrl = '@(Url.Action("mpnc"))/@(entidad.id_entidad)';
        }
        menuModal.initModal(modalOptions);
    }
</script>



<h2>@Strings.getMSG("CertificacionesEntidad004") @entidad.nb_entidad</h2>

<p>
    @if (puedeCertificar.ToString() == "True" && !Model.Any(c=>c.id_periodo_certificacion == id_periodo))
    {
        @Html.ActionLink(Strings.getMSG("Agregar"), "Certificar", new { @id = entidad.id_entidad }, new { @class = "btn btn-default btn-sm" });
    }
    @Html.ActionLink(Strings.getMSG("Regresar"), "Index", null, new { @class = "btn btn-default btn-sm" })

    @if (CertificacionSegura)
    {
        <button type="button" class="btn btn-default pull-right" title="@Strings.getMSG("Atencion")" data-toggle="popover" data-trigger="hover" data-content="@Strings.getMSG("CertificacionInforme010")">
            <i class="fa fa-lock"></i>
        </button>
    }
</p>

<div class="row">
    <div class="card-group" style="margin:0 0 20px 0">
        <div class="card">
            <div class="card-header text-center" style="font-size:1.7rem;font-weight:bold;">@Strings.getMSG("CertificacionesEntidad001")</div>
            <div class="card-body text-center" style="font-size:1.6rem">
                @if (periodo != null)
                {
                    @(periodo.nb_periodo_certificacion + " - " + periodo.anio)
                }
                else
                {
                    @("N/A")
                }
            </div>
        </div>
        <div class="card hover" onclick="info('mpc');">
            <div class="card-header text-center" style="font-size:1.7rem;font-weight:bold;">@Strings.getMSG("CertificacionesEntidad002")</div>
            <div class="card-body text-center" style="font-size:1.6rem">
                @(mpc)
            </div>
        </div>
        <div class="card hover" onclick="info('mpnc');">
            <div class="card-header text-center" style="font-size:1.7rem;font-weight:bold;">@Strings.getMSG("CertificacionesEntidad003")</div>
            <div class="card-body text-center" style="font-size:1.6rem">
                @(mpnc)
            </div>
        </div>
    </div>
</div>
<table id="results" class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th class="search">@Strings.getMSG("PeriodoCertificacionIndex002")</th>
            <th>@Strings.getMSG("CertificacionesEntidad005")</th>
            <th style="word-wrap: break-word">@Strings.getMSG("lyPSeguimientoCreate002")</th>
            <th>@Strings.getMSG("CertificacionesEntidad006")</th>
            <th width="90">@Strings.getMSG("CertificacionesEntidad007")</th>
            <th width="80"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.c_periodo_certificacion.nb_periodo_certificacion)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.leyenda_certificacion_estructura)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.comentarios)
            </td>
            <td>
                @(item.resultado ? Strings.getMSG("UsuarioIndex004"):Strings.getMSG("UsuarioIndex005"))
            </td>
            <td>
                @foreach (var file in item.c_archivo)
                {
                    <a href="@Url.Action("Download",Strings.getMSG("RevisionControlRevisiones003"), new { id = file.id_archivo})"><i class="fa fa-file@(Utilidades.getFileClass(file))" title="@file.nb_archivo"></i></a>
                }
                @if (item.c_archivo.Count() == 0)
                {
                    @:@Strings.getMSG("CertificacionesEntidad010")
                }
            </td>
            <td>
                @if (id_periodo == item.id_periodo_certificacion)
                {
                    <a href="@Url.Action("Edit", new { id = item.id_certificacion_estructura })">
                        <i class="glyphicon glyphicon-pencil" title="@Strings.getMSG("Editar")"></i>
                    </a>
                    @:|
                }
                <a href="@Url.Action("Delete", new { id = item.id_certificacion_estructura })">
                    <i class="glyphicon glyphicon-trash" title="@Strings.getMSG("Borrar")"></i>
                </a> @*|
        <a href="@Url.Action("Details", new { id = item.id_certificacion_estructura })">
            <i class="glyphicon glyphicon-info-sign" title=@Strings.getMSG("Detalles")"></i>
        </a>*@
            </td>
        </tr>
        }
    </tbody>
</table>
