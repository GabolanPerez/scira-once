@model SCIRA.Models.c_sub_proceso
@using SCIRA.Utilidades
@using SCIRA.Models
@using System.Reflection;


<script>
    $(document).ready(function () {
        menuModal.setTitle('@Strings.getMSG("SubProcesoCreate012") @Model.cl_sub_proceso');
        initTables("#menuModal");
    });

    function TiempoUsuario(id) {
        var id_us = id;
        var id_sp= @Model.id_sub_proceso;
        var tiempo_usuario = $("#u" + id).val();
        if (tiempo_usuario == null) tiempo_usuario = 0;
        if (tiempo_usuario == 0) tiempo_usuario = 0;

        var valid = isValidNumber(tiempo_usuario);

        if (valid) {
            url = '@(Url.Action("TiempoParticipante", "Costeo"))';

            $.ajax({
                dataType: "html",
                type: "post",
                cache: false,
                url: url,
                data: { id_sp, id_us, tiempo_usuario},
                success: function (data) {
                    var obj = JSON.parse(data);
                    $("#u" + obj.id).val(obj.val);
                    toastr.success("@Strings.getMSG("CosteoIndex008")")
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    toastr.error("@Strings.getMSG("CosteoIndex009")");
                }
            });
        }

        function isValidNumber(number) {
            var bool = true;
            if (isNaN(number)) bool = false;
            if (number < 0) {
                bool = false;
                toastr.error("@Strings.getMSG("CosteoIndex010")");
            }
            return bool;
        }
    }
</script>


<button class="btn btn-default" onclick="menuModal.bodyLoad('@Url.Action("Details","Costeo")/@Model.id_sub_proceso')">@Strings.getMSG("Regresar")</button>
<br />
<table class="results table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th>
                @Strings.getMSG("CosteoIndex003")
            </th>
            <th>
                @Strings.getMSG("EntidadIndex001")
            </th>
            <th>
                @Strings.getMSG("CosteoIndex004")
            </th>
            <th></th>
        </tr>
    </thead>

    <tbody>
        @foreach (var item in Model.c_usuario_sub_proceso)
        {
            <tr>
                <td>
                    @item.c_usuario.nb_usuario
                </td>
                <td>
                    @SCIRA.Utilidades.Utilidades.PuestoUsuario(item.id_usuario)
                </td>
                <td>
                    <center>
                        @Html.EditorFor(modelItem => item.tiempo_sub_proceso, new { htmlAttributes = new { @class = "form-control S1", @id = "u" + @item.id_usuario } })
                    </center>
                </td>
                <td>
                    <a onclick="TiempoUsuario(@item.id_usuario)">
                        <i class="fa fa-floppy-o fa-lg" title="@Strings.getMSG("Guardar")"></i>
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>