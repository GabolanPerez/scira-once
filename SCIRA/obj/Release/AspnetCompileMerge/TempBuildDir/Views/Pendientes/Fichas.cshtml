@model IEnumerable<SCIRA.Models.r_evento>
@using SCIRA.ViewModels
@using SCIRA.Utilidades
@using Newtonsoft.Json

@{
    var db = new SCIRA.Models.SICIEntities();
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    ViewBag.Title = "Conclusión de Planes de Remediación";
}


<script>
    $(function () {
        chat.client.removeRow = function (typeTable, id, id_usuario) {


            if (UserID == id_usuario && typeTable == 7) {
                table
                    .rows('.R' + id)
                    .remove()
                    .draw();
            }
        };
    });

    function endTask(id,title) {
        confirmationModal.initModal({
            title: '@Strings.getMSG("PendientesFichasIndex003")' + title+ '?',
            action: 'endTaskConfirm('+id+')'
        });
    }

    function endTaskConfirm(id) {
        $("#reg_id").val(id);

        var url = "@(Url.Action("EndTask", "Ficha"))";
        var message = "@Strings.getMSG("PendientesVerTodoIndex012")";

        $.ajax({
            dataType: "html",
            type: "post",
            url: url,
            data: $("#EndTaskForm").serialize(),
            success: function (data) {
                toastr.success(message);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                toastr.error("@Strings.getMSG("AvisoError003")");
            }
        });
    }
</script>


<form id="EndTaskForm" hidden>
    @Html.AntiForgeryToken()
    <input type="text" id="reg_id" name="id" value=""/>
</form>


<link href="~/Content/font-awesome.min.css" rel="stylesheet" />

<h2>@Strings.getMSG("PendientesFichasIndex001")</h2>

<div class="form-horizontal well">
    <table class="results table table-bordered table-striped table-hover table-responsive">
        <thead>
            <tr>
                <th>@Strings.getMSG("NormatividadOperacionIndex001")</th>
                <th>@Strings.getMSG("Responsable")</th>
                <th>@Strings.getMSG("NormatividadOperacionIndex002")</th>
                <th>@Strings.getMSG("NormatividadOperacionIndex003")</th>
                <th>@Strings.getMSG("NotificationEdit003")</th>
                <th>@Strings.getMSG("NormatividadOperacionIndex004")</th>
                <th>@Strings.getMSG("NormatividadOperacionIndex005")</th>
                <th>@Strings.getMSG("NormatividadOperacionIndex006")</th>
                <th width="80px"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                var tipo = Utilidades.tipoFicha(item);
                string registro_ligado = Utilidades.registroLigado(item);
                var reg = Utilidades.GetLastReg(item, db);


                <tr class="R@(item.id_evento)">
                    <td>@item.nb_evento</td>
                    <td>@item.c_usuario.nb_usuario</td>
                    <td>@tipo</td>
                    <td>@registro_ligado</td>
                    <td>@item.ds_evento</td>
                    <td>@(item.recordar_antes_de_vencer ? Strings.getMSG("PendientesVerTodoIndex010") : Strings.getMSG("PendientesVerTodoIndex011"))</td>
                    <td>@Utilidades.getFeLim(item)</td>
                    <td>@Utilidades.GetStatus(item)</td>
                    <td>
                        <center>
                            <a onclick="endTask(@reg.id_registro,'@item.nb_evento')">
                                <i class="fa fa-check" title="@Strings.getMSG("Marcar como Finalizado")"></i>
                            </a>
                        </center>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
