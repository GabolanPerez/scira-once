@model IEnumerable<SCIRA.ViewModels.ListaControlesViewModel>
@using SCIRA.Models;
@using SCIRA.Utilidades
@{
    ViewBag.Title = "Controles";
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    SICIEntities db = new SICIEntities();
    List<SCIRA.ViewModels.AgregarControlViewModel> archivo = (List<SCIRA.ViewModels.AgregarControlViewModel>)ViewBag.costeo;

}
<link href="~/Content/font-awesome.min.css" rel="stylesheet" />

<h3>@Strings.getMSG("RiesgoRiesgos009")<br>[@ViewBag.cl_riesgo - @ViewBag.nb_riesgo]</h3>

<p>
    @Html.ActionLink(Strings.getMSG("Agregar Control"), "Agregar", "Control", new { id = ViewBag.id_riesgo }, new { @class = "btn btn-default btn-sm" })
    @Html.ActionLink(Strings.getMSG("Regresar"), "Riesgos", "Riesgo", new { id = ViewBag.id_sub_proceso }, new { @class = "btn btn-default btn-sm" })
</p>

<table id="results" class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th>@Strings.getMSG("RiesgoControles002")</th>
            <th width="400">@Strings.getMSG("RiesgoControles001")</th>
            <th>@Strings.getMSG("ReporteRevisionControlIndex037")</th>
            <th>@Strings.getMSG("Responsable")</th>
            <th>@Strings.getMSG("RevisionControlRevisiones003")</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            var control = db.k_control.Find(item.id_control);
            <tr>
                <td style="white-space: nowrap">
                    @(item.codigo_control)
                </td>
                <td width="400">
                    @if (item.tiene_accion_correctora)
                    {
                        <b>Acción Correctora: </b>
                        @(item.accion_correctora)
                    }
                    else
                    {
                        @(item.actividad_control)
                    }
                </td>
                <td>
                    @(item.nb_ejecutor)
                </td>
                <td>
                    @(item.nb_responsable)
                </td>
                <td>
                    @foreach (var file in control.c_archivo)
                    {
                        <a href="@Url.Action("Download","Archivos", new { id = file.id_archivo})"><i class="fa fa-file@(Utilidades.getFileClass(file))" title="@file.nb_archivo"></i></a>
                    }
                    @if (control.c_archivo.Count() == 0)
                    {
                        @:@Strings.getMSG("GraphicsRevisionControlIndex019")
                    }
                </td>
                <td style="white-space: nowrap">
                    <center>
                        <a href="@Url.Action("Edit","Control", new { id = item.id_control })">
                            <i class="fa fa-pencil-square-o fa-lg" title="@Strings.getMSG("Editar")"></i>
                        </a> |
                        <a href="@Url.Action("Delete","Control", new { id = item.id_control })">
                            <i class="fa fa-trash fa-lg" title="@Strings.getMSG("Borrar")"></i>
                        </a>
                        @if (control.r_control.Count() > 0)
                        {
                            @:|
                            <a href="@Url.Action("HistorialControl", new { id = item.id_control})">
                                <i class="fa fa-history fa-lg" title="@Strings.getMSG("Historial de cambios")"></i>
                            </a>
                        }
                    </center>
                </td>
            </tr>
        }
    </tbody>
</table>
