@model IEnumerable<SCIRA.Models.k_plan>
@using SCIRA.Utilidades
@{
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    ViewBag.Title = Strings.getMSG("Menu087");

    var PC = Model.Where(p => p.r_conclusion_plan.Count() == 1);
    var PNC = Model.Where(p => p.r_conclusion_plan.Count() == 0);
}

<script src="~/Scripts/Certificacion.js"></script>
<link href="~/Content/font-awesome.min.css" rel="stylesheet" />

<h2>@ViewBag.Title</h2>


<ul class="nav nav-tabs">
    <li class="active"><a href="#pes1" data-toggle="tab"><h4>@Strings.getMSG("ConclusionPlanIndex001")</h4></a></li>
    <li><a href="#pes2" data-toggle="tab"><h4>@Strings.getMSG("ConclusionPlanIndex002")</h4></a></li>
</ul>

<div id="myTabContent" class="tab-content">
    <div class="tab-pane fade active in" id="pes1">
        <br />
        <div class="form-horizontal well">
            <table class="results table table-bordered table-striped table-hover table-responsive">
                <thead>
                    <tr>
                        <th>@Strings.getMSG("ReporteIyPIndex024")</th>
                        <th>@Strings.getMSG("ReporteIyPIndex025")</th>
                        <th>@Strings.getMSG("ReporteIyPIndex026")</th>
                        <th>@Strings.getMSG("Responsable")</th>
                        <th>@Strings.getMSG("Nombre")</th>
                        <th>@Strings.getMSG("SubProcesoCreate018")</th>
                        <th>@Strings.getMSG("Area")</th>
                        <th width="90">@Strings.getMSG("ConclusionPlanIndex004")</th>
                        <th>@Strings.getMSG("BDEIIndex003")</th>
                        <th>@Strings.getMSG("lyPlanesdeRemediacionCreate011")</th>
                        <th width="80px"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in PNC)
                    {
                        var incidencia = item.k_incidencia;
                        string origen = "";
                        string nbOrigen = "";


                        var objeto = incidencia.k_objeto;
                        var cert = incidencia.k_certificacion_control;
                        var control = incidencia.k_control;

                        if (objeto != null)
                        {
                            var tipoObjeto = objeto.tipo_objeto;


                            switch (tipoObjeto)
                            {
                                case 1:
                                    origen = Strings.getMSG("Menu127");
                                    nbOrigen = objeto.nb_objeto;
                                    break;
                                case 2:
                                    origen = Strings.getMSG("ReporteIyPIndex027");
                                    nbOrigen = objeto.nb_objeto;
                                    break;
                                case 3:
                                    origen = Strings.getMSG("ReporteIyPIndex028");
                                    nbOrigen = objeto.nb_objeto;
                                    break;
                                    //case 4:
                                    //    origen = "Certificación";
                                    //    nbOrigen = objeto.nb_objeto;
                                    //    break;
                                    //case 5:
                                    //    origen = "MRyC";
                                    //    nbOrigen = objeto.nb_objeto;
                                    break;
                                case 6:
                                    origen = Strings.getMSG("ReporteIyPIndex021");
                                    nbOrigen = objeto.nb_objeto;
                                    break;
                            }
                        }
                        else if (cert != null)
                        {
                            origen = Strings.getMSG("Menu014");
                            nbOrigen = Strings.getMSG("CertificacionInforme023") + " " + cert.k_control.relacion_control;
                        }
                        else if (control != null)
                        {
                            origen = Strings.getMSG("Control");
                            nbOrigen = control.relacion_control;
                        }

                        <tr>
                            <td>@origen</td>
                            <td>@nbOrigen</td>
                            <td>@item.id_plan</td>
                            <td>@item.c_usuario.nb_usuario</td>
                            <td>@item.nb_plan</td>
                            <td>@item.ds_plan</td>
                            <td>@item.c_area.cl_area - @item.c_area.nb_area</td>
                            <td>
                                @foreach (var file in item.c_archivo)
                                {
                                    <a href="@Url.Action("Download","Archivos", new { id = file.id_archivo})"><i class="fa fa-file@(SCIRA.Utilidades.Utilidades.getFileClass(file))" title="@file.nb_archivo"></i></a>
                                }
                                @if (item.c_archivo.Count() == 0)
                                {
                                    @:@Strings.getMSG("ProcesosAuditoriaIndexEjecucion003")
                                }
                            </td>
                            <td>@(item.fe_alta.HasValue ? item.fe_alta.Value.ToString("dd/MM/yyyy"):"")</td>
                            <td>@(item.fe_estimada_implantacion.HasValue ? item.fe_estimada_implantacion.Value.ToString("dd/MM/yyyy"):"")</td>
                            <td>
                                <center>
                                    <a href="@Url.Action("ConcluirPlan", new { id = item.id_plan})">
                                        <i class="fa fa-check" title="@Strings.getMSG("ConclusionPlanIndex003")"></i>
                                    </a>
                                </center>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <div class="tab-pane" id="pes2">
        <br />
        <div class="form-horizontal well">
            <table class="results table table-bordered table-striped table-hover table-responsive">
                <thead>
                    <tr>
                        <th>@Strings.getMSG("ReporteIyPIndex024")</th>
                        <th>@Strings.getMSG("ReporteIyPIndex025")</th>
                        <th>@Strings.getMSG("ReporteIyPIndex026")</th>
                        <th>@Strings.getMSG("Responsable")</th>
                        <th>@Strings.getMSG("Nombre")</th>
                        <th>@Strings.getMSG("SubProcesoCreate018")</th>
                        <th>@Strings.getMSG("Area")</th>
                        <th width="90">@Strings.getMSG("ConclusionPlanIndex004")</th>
                        <th>@Strings.getMSG("ConclusionPlanCreate001")</th>
                        <th>@Strings.getMSG("BDEIIndex003")</th>
                        <th>@Strings.getMSG("lyPlanesdeRemediacionCreate011")</th>
                        <th>@Strings.getMSG("PlanesRemIndex004")</th>
                        <th width="90">@Strings.getMSG("ConclusionPlanIndex005")</th>
                        <th width="80px"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in PC)
                    {
                        var incidencia = item.k_incidencia;
                        string origen = "";
                        string nbOrigen = "";


                        var objeto = incidencia.k_objeto;
                        var cert = incidencia.k_certificacion_control;
                        var control = incidencia.k_control;

                        if (objeto != null)
                        {
                            var tipoObjeto = objeto.tipo_objeto;


                            switch (tipoObjeto)
                            {
                                case 1:
                                    origen = Strings.getMSG("Menu127");
                                    nbOrigen = objeto.nb_objeto;
                                    break;
                                case 2:
                                    origen = Strings.getMSG("ReporteIyPIndex027");
                                    nbOrigen = objeto.nb_objeto;
                                    break;
                                case 3:
                                    origen = Strings.getMSG("ReporteIyPIndex028");
                                    nbOrigen = objeto.nb_objeto;
                                    break;
                                    //case 4:
                                    //    origen = "Certificación";
                                    //    nbOrigen = objeto.nb_objeto;
                                    //    break;
                                    //case 5:
                                    //    origen = "MRyC";
                                    //    nbOrigen = objeto.nb_objeto;
                                    break;
                                case 6:
                                    origen = Strings.getMSG("ReporteIyPIndex021");
                                    nbOrigen = objeto.nb_objeto;
                                    break;
                            }
                        }
                        else if (cert != null)
                        {
                            origen = Strings.getMSG("Menu014");
                            nbOrigen = Strings.getMSG("CertificacionInforme023") + " " + cert.k_control.relacion_control;
                        }
                        else if (control != null)
                        {
                            origen = Strings.getMSG("Control");
                            nbOrigen = control.relacion_control;
                        }

                        var conclusion = item.r_conclusion_plan.First();
                        <tr>
                            <td>@origen</td>
                            <td>@nbOrigen</td>
                            <td>@item.id_plan</td>
                            <td>@item.c_usuario.nb_usuario</td>
                            <td>@item.nb_plan</td>
                            <td>@item.ds_plan</td>
                            <td>@item.c_area.cl_area - @item.c_area.nb_area</td>
                            <td>
                                @foreach (var file in item.c_archivo)
                                {
                                    <a href="@Url.Action("Download","Archivos", new { id = file.id_archivo})"><i class="fa fa-file@(SCIRA.Utilidades.Utilidades.getFileClass(file))" title="@file.nb_archivo"></i></a>
                                }
                                @if (item.c_archivo.Count() == 0)
                                {
                                    @:@Strings.getMSG("ProcesosAuditoriaIndexEjecucion003")
                                }
                            </td>
                            <td>@conclusion.observaciones</td>
                            <td>@(item.fe_alta.HasValue ? item.fe_alta.Value.ToString("dd/MM/yyyy"):"")</td>
                            <td>@(item.fe_estimada_implantacion.HasValue ? item.fe_estimada_implantacion.Value.ToString("dd/MM/yyyy"):"")</td>
                            <td>@(item.fe_real_solucion.HasValue ? item.fe_real_solucion.Value.ToString("dd/MM/yyyy"):"")</td>
                            <td>
                                @foreach (var file in conclusion.c_archivo)
                                {
                                    <a href="@Url.Action("Download","Archivos", new { id = file.id_archivo})"><i class="fa fa-file@(SCIRA.Utilidades.Utilidades.getFileClass(file))" title="@file.nb_archivo"></i></a>
                                }
                                @if (conclusion.c_archivo.Count() == 0)
                                {
                                    @:@Strings.getMSG("ProcesosAuditoriaIndexEjecucion003")
                                }
                            </td>
                            <td>
                                <center>
                                    <a href="@Url.Action("Edit", new { id = item.r_conclusion_plan.First().id_conclusion_plan })">
                                        <i class="fa fa-pencil" title="@Strings.getMSG("Editar")"></i>
                                    </a>
                                    |
                                    <a href="@Url.Action("Delete", new { id = item.r_conclusion_plan.First().id_conclusion_plan })">
                                        <i class="fa fa-trash" title="@Strings.getMSG("Borrar")"></i>
                                    </a>
                                </center>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>