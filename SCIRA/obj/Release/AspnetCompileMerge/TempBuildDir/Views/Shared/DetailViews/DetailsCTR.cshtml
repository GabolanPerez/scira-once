@model      IEnumerable<SCIRA.Models.k_control>
@using SCIRA.Models;
@using SCIRA.Utilidades
@{ 
    var type = ViewBag.type;

    var cert = type == "certificados";

    int idPeriodo = 0;

    if (cert)
    {
        idPeriodo = ViewBag.idPeriodoC;
    }
}

<script src="~/Scripts/sharedScripts.js"></script>
<script>
    $(document).ready(function () {
        initTables("#menuModal");

        @if(ViewBag.title != null)
        {
        @:menuModal.setTitle("@ViewBag.title");
        }
    });
</script>

<table class="results table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th>@Strings.getMSG("Entidad")</th>
            <th>@Strings.getMSG("MP")</th>
            <th>@Strings.getMSG("P")</th>
            <th>@Strings.getMSG("SP")</th>
            <th>@Strings.getMSG("RiesgoRiesgos002")</th>
            <th>@Strings.getMSG("RiesgoCreate084")</th>
            <th>@Strings.getMSG("Responsable")</th>
            <th>@Strings.getMSG("Puesto")</th>
            <th>@Strings.getMSG("ReporteCambiosMRyCIndex003")</th>
            @if (cert)
            {
                <th>@Strings.getMSG("CertificacionesEntidad008")</th>
            }
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
        <tr>
            <td>
                @(item.c_sub_proceso.c_proceso.c_macro_proceso.c_entidad.cl_entidad + " - " + item.c_sub_proceso.c_proceso.c_macro_proceso.c_entidad.nb_entidad)
            </td>
            <td>
                @(item.c_sub_proceso.c_proceso.c_macro_proceso.cl_macro_proceso + " - " + item.c_sub_proceso.c_proceso.c_macro_proceso.nb_macro_proceso)
            </td>
            <td>
                @(item.c_sub_proceso.c_proceso.cl_proceso + " - " + item.c_sub_proceso.c_proceso.nb_proceso)
            </td>
            <td>
                @(item.c_sub_proceso.cl_sub_proceso + " - " + item.c_sub_proceso.nb_sub_proceso)
            </td>
            <td>
                @(item.k_riesgo.First().nb_riesgo)
            </td>
            <td>
                @(item.relacion_control)
            </td>
            <td>
                @(item.c_usuario1.nb_usuario)
            </td>
            <td>
                @(SCIRA.Utilidades.Utilidades.PuestoUsuario(item.id_responsable ?? 0))
            </td>
            <td>
                @if (item.tiene_accion_correctora)
                {
                    <b>@Strings.getMSG("RiesgoCreate120") </b>@item.accion_correctora
                }
                else
                {
                    @item.actividad_control
                }
            </td>
            @if (cert)
            {
                var certificacion = new k_certificacion_control();

                try
                {
                    certificacion = item.k_certificacion_control.First(c => c.id_periodo_certificacion == idPeriodo);
                }
                catch
                {

                }
                <td>@(certificacion.tiene_disenio_efectivo && certificacion.tiene_funcionamiento_efectivo ? Strings.getMSG("UsuarioIndex004"):Strings.getMSG("UsuarioIndex005"))</td>
            }
        </tr>
        }
    </tbody>
</table>