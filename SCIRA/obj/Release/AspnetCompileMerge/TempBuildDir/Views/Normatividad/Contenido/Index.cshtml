@model IEnumerable<SCIRA.Models.c_contenido_normatividad>
@using SCIRA.Utilidades;
@using SCIRA.Models;
@{
    var db = new SICIEntities();
}

<script src="~/Scripts/sharedScripts.js"></script>
<script>
    $(document).ready(function () {
        initTables("#menuModal");

        @if(ViewBag.title != null)
        {
        @:menuModal.setTitle("@ViewBag.title");
        }

        $(".popover").remove();
    });
</script>

@if (ViewBag.id_abuelo != null)
{
    <input type="button" value="@Strings.getMSG("Atrás")" class="btn btn-default" onclick="loadContent(@ViewBag.id_abuelo)" />
}
@if (ViewBag.id_padre != null)
{
    <input type="button" value="@Strings.getMSG("Agregar Contenido")" class="btn btn-default" onclick="createC(@ViewBag.id_padre)" />
}

@if (ViewBag.id_abuelo != null || ViewBag.id_padre != null)
{
    <br />
    <br />
    <br />
}


@Html.DropDownList("nivelesL", null, Strings.getMSG("NormatividadIndex007"), htmlAttributes: new { @class = "form-control", @title = Strings.getMSG("Atencion"), data_toggle = "popover", data_trigger = "hover", data_content = Strings.getMSG("NormatividadIndex010"), @onchange = "showContents($(this).val());" })

<br />
<br />
<br />
<table class="results table table-bordered table-striped table-hover table-responsive">
    <thead>
        <tr>
            <th width="250px">@Strings.getMSG("NormatividadIndex006")</th>
            <th width="150px">@Strings.getMSG("Clave")</th>
            <th>@Strings.getMSG("Nombre")</th>
            <th width="150px"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            var nivel = item.c_nivel_normatividad;
            var norm = nivel.c_normatividad;
            c_nivel_normatividad nextLVL;
            var ficha = Utilidades.getFicha(item, db);
            try
            {
                nextLVL = norm.c_nivel_normatividad.Where(n => n.no_orden == nivel.no_orden + 1).First();
            }
            catch
            {
                nextLVL = null;
            }


            string ruta = "";
            var padre = item.c_contenido_normatividad2;
            while (padre != null)
            {
                var noRoot = padre.id_contenido_normatividad_padre != null ? "" : "";



                ruta = padre.id_contenido_normatividad_padre != null ? "<a onclick = 'loadContent(" + padre.id_contenido_normatividad_padre + ")'>" + padre.cl_contenido_normatividad + "</a> >> " + ruta : padre.cl_contenido_normatividad + " >> " + ruta;

                padre = padre.c_contenido_normatividad2;
            }

            <tr>
                <td>@Html.Raw(ruta)</td>
                <td><a onclick="loadContent(@item.id_contenido_normatividad)">@item.cl_contenido_normatividad</a>   </td>
                <td><a onclick="loadContent(@item.id_contenido_normatividad)">@item.ds_contenido_normatividad</a></td>
                <td>
                    <center>
                        <a href="@Url.Action("DescargaContenido", new { id = item.id_contenido_normatividad })"><i class="fa fa-download" title="@Strings.getMSG("NormatividadIndex008")"></i></a>
                        |
                        <a onclick="editC(@item.id_contenido_normatividad)"><i class="fa fa-pencil" title="@Strings.getMSG("Editar")"></i></a>
                        @if (item.id_contenido_normatividad_padre != null)
                        {
                            @:|
                            <a onclick="deleteC(@item.id_contenido_normatividad)"><i class="fa fa-trash" title="@Strings.getMSG("Borrar")"></i></a>
                        }
                        |<a><i class="fa fa-id-card @(ficha.id_evento != 0 ? "text-success":"text-danger")" title="@Strings.getMSG("Ficha")" onclick="getFicha(@item.id_contenido_normatividad)"></i></a>
                        @if (nextLVL != null)
                        {
                            @:|
                            <a onclick="createC(@item.id_contenido_normatividad)"><i class="fa fa-plus" title="@Strings.getMSG("Agregar") @nextLVL.nb_nivel_normatividad"></i></a>
                        }
                        else
                        {
                            @:|
                            <a><i class="fa fa-info-circle" title="@Strings.getMSG("NormatividadCreate028")"></i></a>
                        }
                    </center>
                </td>
            </tr>
        }

    </tbody>
</table>


<!-- #region Scripts -->
<script>
    function createC(id_cont) {
        var options = {
            title: "@Strings.getMSG("Crear Contenido")",
            size: "lg",
            show: true,
            loadUrl: "@Url.Action("CreateC","Normatividad")/" + id_cont
        };

        menuModal.initModal(options);
    }

    function editC(id_cont) {
        var options = {
            title: "@Strings.getMSG("Editar Contenido")",
            size: "lg",
            show: true,
            loadUrl: "@Url.Action("EditC","Normatividad")/" + id_cont
        };

        menuModal.initModal(options);
    }

    function deleteC(id_cont) {
        var options = {
            title: "@Strings.getMSG("Normatividadelete001")",
            size: "lg",
            show: true,
            loadUrl: "@Url.Action("DeleteC","Normatividad")/" + id_cont
        };

        menuModal.initModal(options);
    }

    function getFicha(id) {
            menuModal.initModal({
                title: '@Strings.getMSG("Ficha")',
                size: 'lg',
                show: true,
                loadUrl: '@Url.Action("ContenidoNormatividadI","Ficha")/'+id
            });
        }
</script>
<!-- #endregion -->