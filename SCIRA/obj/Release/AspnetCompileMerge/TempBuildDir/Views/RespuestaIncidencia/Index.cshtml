@model IEnumerable<SCIRA.Models.k_incidencia>
@using SCIRA.Utilidades
@{
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    ViewBag.Title = "Responder Incidencias";

    var IC = Model.Where(i => i.r_respuesta.Count() == 1);
    var INC = Model.Where(i => i.r_respuesta.Count() == 0);
}
<script src="~/Scripts/Certificacion.js"></script>


<link href="~/Content/font-awesome.min.css" rel="stylesheet" />

<h2>@Strings.getMSG("Menu088")</h2>


<ul class="nav nav-tabs">
    <li class="active"><a href="#pes1" data-toggle="tab"><h4>@Strings.getMSG("Menu135")</h4></a></li>
    <li><a href="#pes2" data-toggle="tab"><h4>@Strings.getMSG("RespuestaIncidenciaIndex002")</h4></a></li>
</ul>

<div id="myTabContent" class="tab-content">
    <div class="tab-pane fade active in" id="pes1">
        <br />
        <div class="form-horizontal well">
            <table class="results table table-bordered table-striped table-hover table-responsive">
                <thead>
                    <tr>
                        <th>@Strings.getMSG("PlanesRemIndex001")</th>
                        <th>@Strings.getMSG("Responsable")</th>
                        <th>@Strings.getMSG("Nombre")</th>
                        <th>@Strings.getMSG("lyPIndex006")</th>
                        <th>@Strings.getMSG("PendientesVerTodoIndex008")</th>
                        <th>@Strings.getMSG("lyPIncidenciasIndex002")</th>
                        <th>@Strings.getMSG("lyPIncidenciasIndex001")</th>
                        <th width="80px"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in INC)
                    {
                        var nivel = item.lvl_5 ?? item.lvl_4 ?? item.lvl_3 ?? item.lvl_2 ?? item.lvl_1 ?? "N/A";
                        string nb_objeto = "";
                        if (item.id_objeto != null)
                        {
                            nb_objeto = item.k_objeto.nb_objeto;
                        }
                        if (item.id_certificacion_control != null)
                        {
                            nb_objeto = item.k_certificacion_control.cl_certificacion_control;
                        }
                        if (item.id_control != null)
                        {
                            nb_objeto = item.k_control.k_riesgo.First().nb_riesgo;
                        }


                        <tr>
                            <td>@(item.k_objeto.tipo_objeto == 1 ? Strings.getMSG("PendientesVerTodoIndex009") : item.k_objeto.tipo_objeto == 2 ? Strings.getMSG("ReporteIyPIndex010") : Strings.getMSG("ReporteIyPIndex011"))</td>
                            <td>@item.c_usuario.nb_usuario</td>
                            <td>@nb_objeto</td>
                            <td>@(item.k_objeto.tipo_objeto == 1 ? item.k_objeto.fe_vencimiento.Value.ToString("dd/MM/yyyy") : "N/A")</td>
                            <td>@item.id_incidencia</td>
                            <td>@nivel</td>
                            <td>@item.c_clasificacion_incidencia.cl_clasificacion_incidencia - @item.c_clasificacion_incidencia.nb_clasificacion_incidencia</td>
                            <td>
                                <center>
                                    <center>
                                        <a href="@Url.Action("ResponderIncidencia", new { id = item.id_incidencia })">
                                            <i class="fa fa-reply" title="@Strings.getMSG("Responder Incidencia")"></i>
                                        </a>
                                    </center>
                                </center>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <div class="tab-pane" id="pes2">
        <br />
        <div class="form-horizontal well">
            <table class="results table table-bordered table-striped table-hover table-responsive">
                <thead>
                    <tr>
                        <th>@Strings.getMSG("PlanesRemIndex001")</th>
                        <th>@Strings.getMSG("Responsable")</th>
                        <th>@Strings.getMSG("Nombre")</th>
                        <th>@Strings.getMSG("GraphicsOficioIndex023")</th>
                        <th>@Strings.getMSG("PendientesVerTodoIndex008")</th>
                        <th>@Strings.getMSG("lyPIncidenciasIndex002")</th>
                        <th>@Strings.getMSG("lyPIncidenciasIndex001")</th>
                        <th>@Strings.getMSG("RespuestaIncidenciaIndex003")</th>
                        <th>@Strings.getMSG("RespuestaIncidenciaResponderIncidenciaCreate001")</th>
                        <th>@Strings.getMSG("RevisionControlCreate010")</th>
                        <th>@Strings.getMSG("RevisionControlRevisiones003")</th>
                        <th width="80px"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in IC)
                    {
                        var nivel = item.lvl_5 ?? item.lvl_4 ?? item.lvl_3 ?? item.lvl_2 ?? item.lvl_1 ?? "N/A";
                        var respuesta = item.r_respuesta.First();
                        <tr>
                            <td>@(item.k_objeto.tipo_objeto == 1 ? Strings.getMSG("PendientesVerTodoIndex009") : item.k_objeto.tipo_objeto == 2 ? Strings.getMSG("ReporteIyPIndex010") : Strings.getMSG("ReporteIyPIndex011"))</td>
                            <td>@item.c_usuario.nb_usuario</td>
                            <td>@item.k_objeto.nb_objeto</td>
                            <td>@(item.k_objeto.tipo_objeto == 1 ? item.k_objeto.fe_vencimiento.ToString() : "N/A")</td>
                            <td>@item.id_incidencia</td>
                            <td>@nivel</td>
                            <td>@item.c_clasificacion_incidencia.cl_clasificacion_incidencia - @item.c_clasificacion_incidencia.nb_clasificacion_incidencia</td>
                            <td>@respuesta.fe_solucion.Value.ToString("dd/MM/yyyy")</td>
                            <td>@respuesta.contestacion</td>
                            <td>@respuesta.observaciones</td>
                            <td>
                                @if (respuesta.archivo_1 != null)
                                {
                                    <a href="@Url.Action("DescargaArchivo", new { id = respuesta.id_respuesta,index = 1 })">
                                        <i class="fa fa-download fa-lg" title="@respuesta.archivo_1"></i>
                                    </a>
                                }
                                @if (respuesta.archivo_2 != null)
                                {
                                    <a href="@Url.Action("DescargaArchivo", new { id = respuesta.id_respuesta,index = 2 })">
                                        <i class="fa fa-download fa-lg" title="@respuesta.archivo_2"></i>
                                    </a>
                                }
                                @if (respuesta.archivo_3 != null)
                                {
                                    <a href="@Url.Action("DescargaArchivo", new { id = respuesta.id_respuesta,index = 3 })">
                                        <i class="fa fa-download fa-lg" title="@respuesta.archivo_3"></i>
                                    </a>
                                }
                            </td>
                            <td>
                                <center>
                                    <center>
                                        <a href="@Url.Action("Edit", new { id = respuesta.id_respuesta})">
                                            <i class="fa fa-pencil fa-lg" title="@Strings.getMSG("Editar")"></i>
                                        </a>

                                        <a href="@Url.Action("Delete", new { id = respuesta.id_respuesta })">
                                            <i class="fa fa-trash fa-lg" title="@Strings.getMSG("Borrar")"></i>
                                        </a>
                                    </center>
                                </center>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

</div>