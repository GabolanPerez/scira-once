@model IEnumerable<SCIRA.Models.c_sub_proceso>
@using SCIRA.Utilidades
@{
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
    ViewBag.Title = "Sub Procesos";
    int id = ViewBag.id_usuario;
}

<script>
    $(document).ready(function () {
        $('.S2').on('keypress', function (e) {
            if (e.keyCode == 45) {
                return false;
            }
        });
    });

    var submitURL = '@Url.Action("SaveTime","TiemposSubProcesos")'

    function save(id) {
        $("#id_sp").val(id);

        val = $(".val"+id).val();

        if (val == "") {
            toastr.error("@Strings.getMSG("ActividadCosteoEdit004")");
        } else {
            $("#val").val(val);

            executePost(
                submitURL,
                "formTime",
                "toastr.success('@Strings.getMSG("CosteoIndex006")')",
                "toastr.error('@Strings.getMSG("AvisoError003")')"
            );
        }
    } 

    function success() {
        
    }

</script>


<h2>@Strings.getMSG("Menu082")</h2>

<table id="results" class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th class="search">@Strings.getMSG("Entidad")</th>
            <th class="search">@Strings.getMSG("Responsable")</th>
            <th class="search">@Strings.getMSG("MP")</th>
            <th class="search">@Strings.getMSG("Responsable")</th>
            <th class="search">@Strings.getMSG("P")</th>
            <th class="search">@Strings.getMSG("Responsable")</th>
            <th class="search">@Strings.getMSG("SP")</th>
            <th class="search">@Strings.getMSG("Responsable")</th>
            <th>@Strings.getMSG("TiempoSubProcesos001")</th>
            <th width="75"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            var pr = item.c_proceso;
            var mp = pr.c_macro_proceso;
            var en = mp.c_entidad;
            var tiempo = item.c_usuario_sub_proceso.Where(csp => csp.id_usuario == id).First();

        <tr>
            <td>
                @(en.cl_entidad + " - " + en.nb_entidad)
            </td>
            <td>
                @(en.c_usuario.nb_usuario)
            </td>
            <td>
                @(mp.cl_macro_proceso + " - " + mp.nb_macro_proceso)
            </td>
            <td>
                @(mp.c_usuario.nb_usuario)
            </td>
            <td>
                @(pr.cl_proceso + " - " + pr.nb_proceso)
            </td>
            <td>
                @(pr.c_usuario.nb_usuario)
            </td>
            <td>
                @(item.cl_sub_proceso + " - " + item.nb_sub_proceso)
            </td>
            <td>
                @(item.c_usuario.nb_usuario)
            </td>
            <td>
                <input type="number" class="S2 form-control val@(item.id_sub_proceso)" min="0" value="@tiempo.tiempo_sub_proceso.ToString().Replace(".",",")" />
            </td>
            <td>
                <center>
                    <a>
                        <i class="fa fa-save" title="@Strings.getMSG("Guardar")" onclick="save(@item.id_sub_proceso)"></i>
                    </a>
                </center>
            </td>
        </tr>
        }
    </tbody>
</table>

<form id="formTime">
    @Html.AntiForgeryToken()
    <input type="hidden" name="id_us" value="@id" />
    <input type="hidden" id="id_sp" name="id_sp" value="" />
    <input type="hidden" id="val" name="val" value="" />
</form>